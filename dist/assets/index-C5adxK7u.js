var qe=Object.defineProperty;var We=(h,e,t)=>e in h?qe(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var p=(h,e,t)=>We(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();class N{constructor(e,t){p(this,"currentPage","");var n;this.defaultPage=e,this.pages=t;for(const s in t)(n=document.getElementById("app"))==null||n.appendChild(t[s].htmlElement),t[s].hide();window.onhashchange=s=>{this.onOpen()},location.hash.slice(1)==""?location.hash="#"+e:this.onOpen()}onOpen(){var i,o,a;let e={},t=location.hash.slice(1);t.length==0&&(t=this.defaultPage);let n=t.split("&"),s=n[0];n=n.splice(1);for(const r of n){let c=r.split("="),u=decodeURIComponent(c[0]),d=decodeURIComponent(c[1]);e[u]=d}let l=this.currentPage!=s;l&&(console.log("Hide page: "+this.currentPage),(i=this.pages[this.currentPage])==null||i.hide(),this.currentPage=s,console.log("Show page: "+s),(o=this.pages[this.currentPage])==null||o.show()),console.log("Calling page.update with: "+JSON.stringify(e)),(a=this.pages[this.currentPage])==null||a.update(e,l)}static open(e,t){window.setTimeout(()=>{let n="";for(let s in t)n+="&"+encodeURIComponent(s)+"="+encodeURIComponent(t[s]);location.hash="#"+encodeURIComponent(e)+n},200)}static back(){history.back()}}class g{constructor(){}static APPLY_COUNTED(e,t){return t.replace("{count}",e.toString())}}p(g,"TIME_LOCALE","en"),p(g,"TIME_YESTERDAY","yesterday"),p(g,"TIME_HOURS_AGO","{count} hour(s) ago"),p(g,"TIME_MINUTES_AGO","{count} minute(s) ago"),p(g,"TIME_SECONDS_AGO","{count} second(s) ago"),p(g,"TIME_TODAY_AT","today at"),p(g,"TIME_JUST_NOW","just now"),p(g,"APPNAME","Knowledgebase"),p(g,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),p(g,"LOGIN_SESSION_NAME","Session Name"),p(g,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),p(g,"LOGIN_API_TOKEN_LABEL","API Token"),p(g,"LOGIN_SUBMIT","Add Connection"),p(g,"LOGIN_ALL_CONNECTIONS","All"),p(g,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),p(g,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),p(g,"LOGIN_OFFLINE_MODAL_QUESTION","Cannot connect to server. Do you want to continue in offline mode? Offline mode might show you outdated files and data."),p(g,"LOGIN_OFFLINE_MODAL_CONFIRM","Continue offline"),p(g,"LOGIN_OFFLINE_MODAL_CANCEL","Return to login"),p(g,"SEARCH_FILETREE_IS_NULL","Cannot retrieve list of files. Maybe you have a weak internet connection."),p(g,"SEARCH_PLACEHOLDER","Search (Keyword, Keyword, Keyword)"),p(g,"SEARCH_LAST_MODIFIED","modified"),p(g,"SEARCH_CREATED","created"),p(g,"SEARCH_NUM_RESULTS","files found"),p(g,"SEARCH_OFFLINE",", Offline:"),p(g,"SEARCH_MORE_RESULTS","Click here to show more results!"),p(g,"SETTINGS_TITLE","Settings"),p(g,"SETTINGS_GENERAL","General"),p(g,"SETTINGS_CONNECTION","Connection"),p(g,"SETTINGS_SELECT_SERVER","Select server"),p(g,"SETTINGS_DISPLAY","Display"),p(g,"SETTINGS_SHOW_TXT_PREVIEWS","Show previews for text documents"),p(g,"SETTINGS_SHOW_IMG_PREVIEWS","Show previews for images"),p(g,"SETTINGS_SHOW_PDF_PREVIEWS","Show previews for PDFs"),p(g,"SETTINGS_AUTOLOGIN","Autoconnect to all servers"),p(g,"UPLOAD_TITLE","Upload File"),p(g,"UPLOAD_SERVER","Server"),p(g,"UPLOAD_FOLDERNAME","Foldername"),p(g,"UPLOAD_FILENAME","Filename"),p(g,"UPLOAD_FILE","File"),p(g,"UPLOAD_SEND","Upload"),p(g,"UPLOAD_FAILED","Upload failed. Reasons could be: The file already exists, the folder is invalid or the server is currently unreachable."),p(g,"EDIT_READ_FILE_ERROR","Cannot read file or reach server. Maybe your internet connection is too weak or the server is down."),p(g,"EDIT_SAVE_FILE_ERROR","Cannot save file. It was either changed on the server or you have too weak internet."),p(g,"EDIT_READ_MD5_ERROR","Cannot read md5 of file. Maye there was an error saving or your internet is weak."),p(g,"EDIT_EXIT_WITHOUT_SAVE_QUESTION","You did not save your changes. Do you want to exit anyways or continue editing?"),p(g,"EDIT_EXIT_WITHOUT_SAVE_EXIT","Exit (Discard Changes)"),p(g,"EDIT_EXIT_WITHOUT_SAVE_CONTINUE_EDITING","Continue Editing"),p(g,"EDIT_DOWNLOAD_HEADING","Access File"),p(g,"EDIT_DOWNLOAD_BTN","Open (Here)"),p(g,"EDIT_OPEN_NATIVELY","Open (Native)"),p(g,"EDIT_UPLOAD_HEADING","Update File"),p(g,"EDIT_UPLOAD_BTN","Upload");class ie extends g{}p(ie,"TIME_LOCALE","de"),p(ie,"APPNAME","Wissensdatenbank");let m=g;function je(){switch(localStorage.language){case"de":m=ie;break;case"en":case"us":default:m=g;break}}const ee=class ee{constructor(e){p(this,"apiEndpoint","");p(this,"sessionToken","");this.session_name=e,this.loadSessionConfig(),ee.connections.set(e,this)}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);if(this.session_name in e){let t=e[this.session_name];this.apiEndpoint=t.apiEndpoint,this.sessionToken=t.sessionToken}}}writeSessionConfig(e,t){this.apiEndpoint=e,this.sessionToken=t;let n={};localStorage.webfs_sessions&&(n=JSON.parse(localStorage.webfs_sessions)),n[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:t},localStorage.webfs_sessions=JSON.stringify(n)}removeSession(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);e.indexOf(this.session_name)>=0&&e.remove(this.session_name)}}async request(e){e.append("token",this.sessionToken);const t={method:"POST",body:e};try{return await fetch(this.apiEndpoint,t)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let e=new FormData;e.append("cmd","ping"),e.append("uri",".");let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):await t.text()=="pong"}async login(e,t){let n=new FormData;n.append("cmd","login"),n.append("uri","."),n.append("token",t);const s={method:"POST",body:n};let l;try{l=await fetch(e,s)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(l.status!=200)return console.error(l.text()),!1;let i=await l.text();return this.writeSessionConfig(e,i),!0}buildFileTree(e){return e}async list(e){let t=new FormData;t.append("cmd","list"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):await n.json()}async walk(e){let t=new FormData;t.append("cmd","walk"),t.append("uri",e);let n=await this.request(t);if(n==null)return null;if(n.status!=200)return console.error(n.text()),null;let s=await n.json();return this.buildFileTree(s)}async md5(e){let t=new FormData;t.append("cmd","md5"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}async open(e){let t=new FormData;t.append("cmd","open"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async readTxt(e){let t=new FormData;t.append("cmd","read"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}readURL(e,t=0){let n="";return t!=0&&(n="&subsample=1&width="+t.toFixed(0)+"&height="+t.toFixed(0)),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(e)+n}read(e,t="_self"){function n(i,o,a){let r=document.createElement("input");r.type="hidden",r.name=o,r.value=a,i.appendChild(r)}let s=document.getElementsByTagName("body")[0],l=document.createElement("form");l.action=this.apiEndpoint,l.method="post",l.target=t,n(l,"cmd","read"),n(l,"token",this.sessionToken),n(l,"uri",e),s.appendChild(l),l.submit(),s.removeChild(l)}async putTxt(e,t,n){var s=new Blob([t],{type:"text/plain;charset=utf-8"});return this.putFile(e,s,n)}async putFile(e,t,n){let s="",l=new FormData;l.append("cmd","write"),l.append("operation","write"),l.append("uri",e),l.append("file",t),l.append("md5",n+","+s);let i=await this.request(l);return i==null?!1:i.status!=200?(console.error(i.text()),!1):(await i.text(),!0)}async mkdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","mkdir"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rmdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","rmdir"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async mv(e,t){let n=new FormData;n.append("cmd","write"),n.append("operation","mv"),n.append("uri",e),n.append("target",t);let s=await this.request(n);return s==null?!1:s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}async rm(e,t){let n=new FormData;n.append("cmd","write"),n.append("operation","rm"),n.append("uri",e),n.append("md5",t);let s=await this.request(n);return s==null?!1:s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}};p(ee,"connections",new Map);let I=ee;class k{constructor(e,t="",n=""){p(this,"parent",null);p(this,"htmlElement");p(this,"displayStyle","none");this.htmlElement=document.createElement(e),this.htmlElement.innerHTML=t,n!=""&&this.setClass(n)}add(e){this.htmlElement.appendChild(e.htmlElement),e.parent=this}remove(e){this.htmlElement.removeChild(e.htmlElement),e.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(e,t){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(e){this.hasClass(e)||this.htmlElement.classList.add(e)}unsetClass(e){this.hasClass(e)&&this.htmlElement.classList.remove(e)}hasClass(e){return this.htmlElement.classList.contains(e)}}class T extends k{constructor(e,t=""){super("a",e,t),this.htmlElement.onclick=n=>{n.stopPropagation(),this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class Ye extends k{constructor(...e){super("div");for(const t of e)this.add(t)}submit(){let e=new FormData;for(const t in this.htmlElement.children){let n=this.htmlElement.children[t];n instanceof HTMLInputElement&&e.append(n.name,n.value)}this.onSubmit(e)}onSubmit(e){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(e)}}class B extends k{constructor(e,t,n,s=""){super("input"),this.htmlElement.name=e,this.htmlElement.placeholder=t,this.htmlElement.type=n,s!=""&&this.setClass(s),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(e=void 0){return e!==void 0&&(this.htmlElement.value=e),this.htmlElement.value}onChange(e){}onChangeDone(e){}}class M extends k{constructor(e,t=""){super("label",e,t)}}class Y extends k{constructor(t,n,s="",l=!1){super("div");p(this,"checkbox");this.checkbox=new k("input"),this.checkbox.htmlElement.name=t,this.checkbox.htmlElement.type="checkbox",this.checkbox.htmlElement.checked=l,s!=""&&this.setClass(s),this.checkbox.htmlElement.onchange=()=>{this.onChange(this.checkbox.htmlElement.checked)},this.add(this.checkbox);let i=new k("label");i.htmlElement.innerHTML=n,this.add(i)}onChange(t){console.log("Checkbox::onChange: Not implemented! Must be implemented by subclass.")}value(t=void 0){return t!==void 0&&(this.checkbox.htmlElement.checked=t),this.checkbox.htmlElement.checked}}class Ze extends k{constructor(t,n,s="",l=""){super("div");p(this,"dropDown");this.dropDown=new k("select","",s),this.dropDown.htmlElement.name=t;for(let i=0;i<n.length;i++){let o=new k("option",n[i],l);this.dropDown.add(o)}this.dropDown.htmlElement.onchange=()=>{this.onChange(this.dropDown.htmlElement.value)},this.add(this.dropDown)}value(t=void 0){return t!==void 0&&(this.dropDown.htmlElement.value=t),this.dropDown.htmlElement.value}onChange(t){}}class Xe extends T{onClick(){this.parent.submit()}}let Ae='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>',Qe='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 352 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>',V='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>';class Ne extends k{constructor(t,n){var s;super("div");p(this,"container");this.setClass(t),this.container=new k("div"),this.container.setClass(n),this.container.add(this),(s=document.getElementById("global"))==null||s.appendChild(this.container.htmlElement)}dispose(){var t;this.onExit(),(t=document.getElementById("global"))==null||t.removeChild(this.container.htmlElement)}onExit(){}update(){}}class le extends Ne{constructor(e,t,n,s,l){super(e,t),this.add(new k("p",n));let i=new T(s,"popupConfirmBtn");i.onClick=()=>{this.dispose(),this.onConfirm()},this.add(i);let o=new T(l,"popupCancelBtn");o.onClick=()=>{this.dispose(),this.onCancel()},this.add(o)}onConfirm(){console.log("ConfirmCancelPopup::onConfirm not implemented. Must be implemented by subclass.")}onCancel(){console.log("ConfirmCancelPopup::onCancel not implemented. Must be implemented by subclass.")}}class Oe extends Ne{constructor(e="popupContent",t="popupContainer",n="popupExitBtn"){super(e,t);let s=new T(Qe,n);s.onClick=this.dispose.bind(this),this.add(s)}update(){}}let F="webfs";function Je(h){F=h}class Ke extends k{constructor(){super("div");p(this,"connections");this.setClass("loginView"),this.connections=new k("div"),this.add(this.connections);let t=new Ye(new M(m.LOGIN_SESSION_NAME,"loginLabel"),new B("sessionName","myserver","text","loginInput"),new M(m.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new B("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new M(m.LOGIN_API_TOKEN_LABEL,"loginLabel"),new B("apiToken","a4ef9...","password","loginInput"),new Xe(m.LOGIN_SUBMIT,"loginButtonWide"));t.setClass("loginForm"),t.onSubmit=this.onCreateSession.bind(this),this.add(t)}update(t,n){if(this.connections.htmlElement.innerHTML="",localStorage[F+"_sessions"]){let s=JSON.parse(localStorage[F+"_sessions"]);if(s.length>0&&this.connections.add(new M(m.LOGIN_KNOWN_CONNECTIONS,"loginLabel")),s.length>0){let l=new T(m.LOGIN_ALL_CONNECTIONS,"loginKnownConnectionButton");l.onClick=()=>{De(),N.back()},this.connections.add(l)}for(const l of s){let i=new T(l,"loginKnownConnectionButton");i.onClick=()=>{et(l)},this.connections.add(i)}if(s.length>0){let l=new k("hr");l.setClass("loginDivider"),this.connections.add(l)}}}async onCreateSession(t){let n=t.get("sessionName"),s=t.get("apiEndpoint"),l=t.get("apiToken");if(n==""||s==""||l==""||n==null||s==null||l==null){alert(m.LOGIN_ERROR_MISSING_INPUTS);return}if(await new I(n).login(s,l)){let o=[];localStorage[F+"_sessions"]&&(o=JSON.parse(localStorage[F+"_sessions"])),o.push(n),localStorage[F+"_sessions"]=JSON.stringify(o),N.back()}else I.connections.delete(n),alert(m.LOGIN_ERROR_LOGIN_FAILED)}}async function et(h){if(console.log("Connecting to: "+h),await new I(h).ping())localStorage[F+"_last_session"]=h,N.back();else{let t=new le("popupContent","popupContainer",m.LOGIN_OFFLINE_MODAL_QUESTION,m.LOGIN_OFFLINE_MODAL_CONFIRM,m.LOGIN_OFFLINE_MODAL_CANCEL);return new Promise(n=>{t.onConfirm=()=>{localStorage[F+"_last_session"]=h,N.back(),n()},t.onCancel=()=>{I.connections.delete(h),n()}})}}function De(){if(localStorage[F+"_sessions"]){let h=JSON.parse(localStorage[F+"_sessions"]);if(h.length>0)for(let e of h)new I(e)}}const tt=6,nt=6,st=10,it=12,lt=.001,ge=31557600,we=2629800,ke=86400,be=3600,xe=60;function ot(h,e="long"){let t=new Date;const n=Se(t,h),{hours:s,minutes:l,seconds:i}=n;let o=new Date(t.toISOString().substring(0,10)),a=new Date(h.toISOString().substring(0,10));const r=Se(o,a),{years:c,months:u,days:d}=r;return c>100?"unknown":c>0||u>nt?_e(h,{includeYear:!0,length:e}):u>0||d>tt?_e(h,{includeYear:!1,length:e}):d>1?h.toLocaleDateString(m.TIME_LOCALE,{weekday:e}):d===1?m.TIME_YESTERDAY:s>it?m.TIME_TODAY_AT+" "+h.toLocaleTimeString(m.TIME_LOCALE,{hour:"numeric",minute:"2-digit"}):s>0?m.APPLY_COUNTED(s,m.TIME_HOURS_AGO):l>0?m.APPLY_COUNTED(l,m.TIME_MINUTES_AGO):i>st?m.APPLY_COUNTED(i,m.TIME_SECONDS_AGO):m.TIME_JUST_NOW}function _e(h,{includeYear:e,length:t}){const n=h.toLocaleDateString(m.TIME_LOCALE,{month:t});let l=`${h.getDate().toString()}. ${n}`;return e&&(l+=` ${h.getFullYear()}`),l}function Ee(h){return Math.floor(h*lt)}function Se(h,e){const t={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};let n=Ee(h.valueOf())-Ee(e.valueOf());return t.years=Math.floor(n/ge),n-=t.years*ge,t.months=Math.floor(n/we),n-=t.months*we,t.days=Math.floor(n/ke),n-=t.days*ke,t.hours=Math.floor(n/be),n-=t.hours*be,t.minutes=Math.floor(n/xe),n-=t.minutes*xe,t.seconds=n,t}let rt='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>',at='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.6 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/></svg>',ct='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"/></svg>',ht='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M48 24C48 10.7 37.3 0 24 0S0 10.7 0 24V64 350.5 400v88c0 13.3 10.7 24 24 24s24-10.7 24-24V388l80.3-20.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L48 52V24zm0 77.5l96.6-24.2c27-6.7 55.5-3.6 80.4 8.8c54.9 27.4 118.7 29.7 175 6.8V334.7l-24.4 9.1c-33.7 12.6-71.2 10.7-103.4-5.4c-48.2-24.1-103.3-30.1-155.6-17.1L48 338.5v-237z"/></svg>',pt='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 480H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H288c-10.1 0-19.6-4.7-25.6-12.8L243.2 57.6C231.1 41.5 212.1 32 192 32H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64z"/></svg>',oe='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M246.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-128 128c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 109.3V320c0 17.7 14.3 32 32 32s32-14.3 32-32V109.3l73.4 73.4c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-128-128zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64c0 53 43 96 96 96H352c53 0 96-43 96-96V352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V352z"/></svg>',Te='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z"/></svg>',ut='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"/></svg>',Ce='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>',dt='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M418.4 157.9c35.3-8.3 61.6-40 61.6-77.9c0-44.2-35.8-80-80-80c-43.4 0-78.7 34.5-80 77.5L136.2 151.1C121.7 136.8 101.9 128 80 128c-44.2 0-80 35.8-80 80s35.8 80 80 80c12.2 0 23.8-2.7 34.1-7.6L259.7 407.8c-2.4 7.6-3.7 15.8-3.7 24.2c0 44.2 35.8 80 80 80s80-35.8 80-80c0-27.7-14-52.1-35.4-66.4l37.8-207.7zM156.3 232.2c2.2-6.9 3.5-14.2 3.7-21.7l183.8-73.5c3.6 3.5 7.4 6.7 11.6 9.5L317.6 354.1c-5.5 1.3-10.8 3.1-15.8 5.5L156.3 232.2z"/></svg>',ft='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 640 512"><!--!Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M208 352c114.9 0 208-78.8 208-176S322.9 0 208 0S0 78.8 0 176c0 38.6 14.7 74.3 39.6 103.4c-3.5 9.4-8.7 17.7-14.2 24.7c-4.8 6.2-9.7 11-13.3 14.3c-1.8 1.6-3.3 2.9-4.3 3.7c-.5 .4-.9 .7-1.1 .8l-.2 .2s0 0 0 0s0 0 0 0C1 327.2-1.4 334.4 .8 340.9S9.1 352 16 352c21.8 0 43.8-5.6 62.1-12.5c9.2-3.5 17.8-7.4 25.2-11.4C134.1 343.3 169.8 352 208 352zM448 176c0 112.3-99.1 196.9-216.5 207C255.8 457.4 336.4 512 432 512c38.2 0 73.9-8.7 104.7-23.9c7.5 4 16 7.9 25.2 11.4c18.3 6.9 40.3 12.5 62.1 12.5c6.9 0 13.1-4.5 15.2-11.1c2.1-6.6-.2-13.8-5.8-17.9c0 0 0 0 0 0s0 0 0 0l-.2-.2c-.2-.2-.6-.4-1.1-.8c-1-.8-2.5-2-4.3-3.7c-3.6-3.3-8.5-8.1-13.3-14.3c-5.5-7-10.7-15.4-14.2-24.7c24.9-29 39.6-64.7 39.6-103.4c0-92.8-84.9-168.9-192.6-175.5c.4 5.1 .6 10.3 .6 15.5z"/></svg>';class mt extends k{constructor(){super("div");p(this,"searchField");p(this,"results");p(this,"fileTrees",new Map);p(this,"offlineConnections",[]);this.searchField=new B("search",m.SEARCH_PLACEHOLDER,"search","searchInput"),this.searchField.onChange=r=>{this.updateSearchResults()},this.searchField.onChangeDone=r=>{N.open("search",{q:r})},this.add(this.searchField),this.results=new k("div"),this.results.setClass("searchResults"),this.add(this.results);let t=new k("div","","searchBottomNavbar"),n=new Z("Folders",pt);n.onClick=()=>{this.searchField.htmlElement.value="/",this.searchField.onChangeDone("/")},t.add(n);let s=new Z("AI",ft);s.onClick=()=>{alert("AI-feature is not yet implemented!")},t.add(s);let l=new Z("Graph",dt);l.onClick=()=>{alert("Graph View is not yet implemented")},t.add(l);let i=new Z("Settings",Ae);i.onClick=()=>{let r=new kt;r.onExit=this.updateSearchResults.bind(this)},t.add(i),this.add(t);let o=new T(oe,"searchUploadButton");o.onClick=()=>{let r="/",c=this.searchField.value().split(",").map(u=>u.trim());for(let u of c)if(u.startsWith("/")){r=u;break}new bt(r,"",this.triggerFullUpdate.bind(this))},this.add(o);let a=new T(V,"settingsOpen");a.onClick=()=>{let r=this.searchField.value().trim();r!=""&&r!="/"&&history.back()},this.add(a)}triggerFullUpdate(){this.update({q:this.searchField.value()},!0)}async update(t,n){if(I.connections.size<1){N.open("login",{});return}if(n){this.offlineConnections=[],this.fileTrees.clear(),this.results.htmlElement.innerHTML="";for(let[s,l]of I.connections){console.log("Gathering filetrees for: "+s);let i=await l.walk(".");if(i==null){console.log("Session offline: "+s);let o=localStorage["kb_filetree_cache_"+s];o&&(i=JSON.parse(o)),this.offlineConnections.push(s)}else{let o=JSON.stringify(i);localStorage["kb_filetree_cache_"+s]=o}i!=null&&this.fileTrees.set(s,i)}}this.searchField.value(t.q),this.updateSearchResults()}async updateSearchResults(t=50){let n=this.searchField.value();this.results.htmlElement.innerHTML="";let s=[];for(let[i,o]of this.fileTrees){let a=this.flatten(i,o);console.log(i+": "+a.length),s=s.concat(a)}if(s.length==0){alert(m.SEARCH_FILETREE_IS_NULL);return}s=this.sortFilesByLastModified(s),s=this.sortFilesByRelevance(s,n),this.showNumResults(s);let l=s.length;s=s.slice(0,t);for(let i of s)this.results.add(new gt(i.filepath,i.sessionName,i.modified!=null?ot(i.modified):"",i.isFolder,this.searchField,this.triggerFullUpdate.bind(this)));if(l>t){let i=new k("div");i.htmlElement.innerText=m.SEARCH_MORE_RESULTS,i.setClass("searchMoreResults"),i.htmlElement.onclick=()=>{this.updateSearchResults(t+25)},this.results.add(i)}}showNumResults(t){let n=new k("div"),s="";for(let l of this.offlineConnections)s==""&&(s=m.SEARCH_OFFLINE),s+=" "+l;n.htmlElement.innerHTML=t.length+" "+m.SEARCH_NUM_RESULTS+s,n.setClass("searchNumResults"),this.results.add(n)}sortFilesByRelevance(t,n){let s=n.toLowerCase().split(",").map(o=>o.trim()),l=[];for(let o of t){let{filename:a,folder:r}=Fe(o.filepath);a=a.toLowerCase(),r=r.toLowerCase();var i=0;for(let c of s){if(c==""){i+=1;continue}let u=c.startsWith("/"),d=c.substring(1);d==""&&(d="."),!u&&a.includes(c)&&(i+=100,o.isFolder&&(i+=10)),u&&o.isFolder&&a.includes(d)&&o.filepath.toLowerCase()!=d&&(i+=125,a==d&&(i+=25)),u&&r==d&&(i+=100,o.isFolder&&(i+=10))}i>0&&(a.includes(".fav")&&(i+=3),a.includes(".todo")&&(i+=4),l.push({filepath:o.filepath,sessionName:o.sessionName,modified:o.modified,isFolder:o.isFolder,score:i}))}return l.sort((o,a)=>a.score-o.score)}sortFilesByLastModified(t){return t.sort((n,s)=>n.modified==null?1:s.modified==null?-1:s.modified.toISOString().localeCompare(n.modified.toISOString()))}flatten(t,n,s="",l=[]){for(const o in n){var i=n[o];typeof i!="string"?(l=this.flatten(t,i,s+o+"/",l),l.push({filepath:s+o,sessionName:t,modified:null,isFolder:!0})):(i.indexOf("GMT")<0&&(i+=" GMT+0000"),l.push({filepath:s+o,sessionName:t,modified:new Date(i),isFolder:!1}))}return l}}class Z extends T{constructor(e,t){super("","searchBottomNavbarButton"),this.add(new k("div",t,"searchBottomNavbarIcon")),this.add(new k("div",e,"searchBottomNavbarText"))}setIcon(e){this.htmlElement.children[0].innerHTML=e}}class gt extends k{constructor(e,t,n,s,l,i){super("div"),this.setClass("searchResult");let o=I.connections.get(t),{filename:a,folder:r}=Fe(e),c=a.split(".");s&&c.push("DIR");let u=c[c.length-1].toLowerCase();if(localStorage.kb_allow_img_previews=="true"&&(u=="png"||u=="jpg"||u=="jpeg"||u=="tiff"||u=="tif")||localStorage.kb_allow_pdf_previews=="true"&&u=="pdf"){let b=document.createElement("img");b.classList.add("searchResultPreview"),b.onerror=()=>{let C=document.createElement("div");C.innerHTML="<BR>"+u.toUpperCase(),C.classList.add("searchResultPreview"),this.htmlElement.replaceChild(C,this.htmlElement.childNodes[0])},o!=null&&(b.src=o.readURL(e,256)),this.htmlElement.appendChild(b)}else if(localStorage.kb_allow_txt_previews=="true"&&(u=="txt"||u=="md"||u=="py"||u=="csv"||u=="json")){let b=document.createElement("div");b.style.fontSize="1em",b.style.textAlign="left",b.innerHTML="loading...",wt.getTxtPreview(t,e).then(C=>{let y=C.split(`
`);y=y.map((L,P,O)=>L.startsWith("#")?"<b style='font-size: 1.2em'>"+L+"</b>":L),C=y.join("<BR>"),b.innerHTML=C}),b.classList.add("searchResultPreview"),this.htmlElement.appendChild(b)}else{let b=document.createElement("div");b.innerHTML="<BR>"+u.toUpperCase(),b.classList.add("searchResultPreview"),this.htmlElement.appendChild(b)}let d=document.createElement("div");d.classList.add("searchResultMeta"),this.htmlElement.appendChild(d);let f=document.createElement("div");f.innerText=a.replace(".todo","").replace(".fav",""),f.classList.add("searchResultFilename"),d.appendChild(f);let x=document.createElement("div");if(x.innerText=t,x.classList.add("searchResultServer"),d.appendChild(x),n!=""){let b=document.createElement("div");b.innerText=m.SEARCH_LAST_MODIFIED+": "+n,b.classList.add("searchResultModified"),d.appendChild(b)}let w=document.createElement("div");w.innerText=r,w.classList.add("searchResultFolder"),d.appendChild(w),this.htmlElement.onclick=()=>{s?(l.htmlElement.value="/"+e,l.onChange(l.htmlElement.value),l.onChangeDone(l.htmlElement.value)):N.open("edit",{sessionName:t,folder:r,filename:a})};let _=document.createElement("div");if(_.classList.add("searchResultHover"),this.htmlElement.appendChild(_),!s){let b=new k("div","","searchResultFlagButtonContainer"),C=a.includes(".fav"),y=new T(C?rt:at,"searchResultFlagButton");y.onClick=async()=>{if(o!=null){if(C)await o.mv(e,e.replace(".fav",""));else{let O=e.split(".");O.splice(O.length-1,0,"fav"),await o.mv(e,O.join("."))}i()}},b.add(y);let L=a.includes(".todo"),P=new T(L?ct:ht,"searchResultFlagButton");P.onClick=async()=>{if(o!=null){if(L)await o.mv(e,e.replace(".todo",""));else{let O=e.split(".");O.splice(O.length-1,0,"todo"),await o.mv(e,O.join("."))}i()}},b.add(P),this.add(b)}}}function Fe(h){let e=h.split("/"),t=e.pop(),n=e.join("/");return n==""&&(n="."),{filename:t,folder:n}}class wt{constructor(){}static async getTxtPreview(e,t){var l;let n=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");if(n[t])return n[t];let s=await((l=I.connections.get(e))==null?void 0:l.readTxt(t));if(s!=null){let i=s.split(`
`).slice(0,13);i=i.map((a,r,c)=>a.slice(0,40)),s=i.join(`
`);let o=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");return o[t]=s,localStorage.setItem("kb_preview_cache",JSON.stringify(o)),s}return"error loading preview"}static async getImgPreview(e){return""}}class kt extends Oe{constructor(){super("popupContent-fullscreen","popupContainer","popupExitBtn"),this.add(new k("div",m.SETTINGS_TITLE,"popupTitle")),this.add(new k("div",m.SETTINGS_GENERAL,"popupSubtitle")),this.add(new k("div",m.SETTINGS_DISPLAY,"popupSubtitle"));let e=new Y("showTxtPreviews",m.SETTINGS_SHOW_TXT_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_txt_previews=="true");e.onChange=i=>{localStorage.kb_allow_txt_previews=i},this.add(e);let t=new Y("showImgPreviews",m.SETTINGS_SHOW_IMG_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_img_previews=="true");t.onChange=i=>{localStorage.kb_allow_img_previews=i},this.add(t);let n=new Y("showPDFPreviews",m.SETTINGS_SHOW_PDF_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_pdf_previews=="true");n.onChange=i=>{localStorage.kb_allow_pdf_previews=i},this.add(n),this.add(new k("div",m.SETTINGS_CONNECTION,"popupSubtitle"));let s=new T(m.SETTINGS_SELECT_SERVER,"buttonWide");s.onClick=()=>{this.dispose(),I.connections.clear(),N.open("login",{})},this.add(s);let l=new Y("autoLogin",m.SETTINGS_AUTOLOGIN,"settingsCheckbox",localStorage.kb_autologin=="true");l.onChange=i=>{localStorage.kb_autologin=i},this.add(l)}update(){}}class bt extends Oe{constructor(e,t,n){super("popupContent-fullscreen","popupContainer","popupExitBtn"),this.setClass("upload"),this.add(new k("div",m.UPLOAD_TITLE,"popupTitle")),this.add(new M(m.UPLOAD_SERVER));let s=[];for(let c of I.connections.keys())s.push(c);let l=new Ze("sessionName",s,"");this.add(l),this.add(new M(m.UPLOAD_FOLDERNAME));let i=new B("foldername",e,"text");i.value(e),this.add(i),this.add(new M(m.UPLOAD_FILENAME));let o=new B("filename",t,"text");o.value(t),this.add(o),this.add(new M(m.UPLOAD_FILE));let a=new B("file","","file","fileInput");a.onChangeDone=c=>{if(o.value()==""){let u=c.replaceAll("\\","/").split("/");o.value(u[u.length-1])}},this.add(a);let r=new T(m.UPLOAD_SEND,"buttonWide");r.onClick=async()=>{let c=l.value(),u=I.connections.get(c);if(u==null)return;r.htmlElement.disabled=!0;let d=a.htmlElement.files[0],f=i.value();f.endsWith("/")&&(f=f.slice(0,f.length-1));let x=o.value(),w=f+"/"+x,_=await u.putFile(w,d,"");r.htmlElement.disabled=!1,_?(this.dispose(),n()):alert(m.UPLOAD_FAILED)},this.add(r)}update(){}}function ae(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let H=ae();function Pe(h){H=h}const q={exec:()=>null};function S(h,e=""){let t=typeof h=="string"?h:h.source;const n={replace:(s,l)=>{let i=typeof l=="string"?l:l.source;return i=i.replace(v.caret,"$1"),t=t.replace(s,i),n},getRegex:()=>new RegExp(t,e)};return n}const v={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:h=>new RegExp(`^( {0,3}${h})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}#`),htmlBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}<(?:[a-z].*>|!--)`,"i")},xt=/^(?:[ \t]*(?:\n|$))+/,_t=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Et=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,j=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,St=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Me=/(?:[*+-]|\d{1,9}[.)])/,Be=S(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,Me).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),ce=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Tt=/^[^\n]+/,he=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Ct=S(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",he).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),yt=S(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Me).getRegex(),te="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",pe=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,vt=S("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",pe).replace("tag",te).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),$e=S(ce).replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex(),It=S(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",$e).getRegex(),ue={blockquote:It,code:_t,def:Ct,fences:Et,heading:St,hr:j,html:vt,lheading:Be,list:yt,newline:xt,paragraph:$e,table:q,text:Tt},ye=S("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex(),Lt={...ue,table:ye,paragraph:S(ce).replace("hr",j).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",ye).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",te).getRegex()},Rt={...ue,html:S(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",pe).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:q,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:S(ce).replace("hr",j).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Be).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},He=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,At=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,ze=/^( {2,}|\\)\n(?!\s*$)/,Nt=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ne=/[\p{P}\p{S}]/u,de=/[\s\p{P}\p{S}]/u,Ue=/[^\s\p{P}\p{S}]/u,Ot=S(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,de).getRegex(),Dt=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Ft=S(/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,"u").replace(/punct/g,ne).getRegex(),Pt=S("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)","gu").replace(/notPunctSpace/g,Ue).replace(/punctSpace/g,de).replace(/punct/g,ne).getRegex(),Mt=S("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Ue).replace(/punctSpace/g,de).replace(/punct/g,ne).getRegex(),Bt=S(/\\(punct)/,"gu").replace(/punct/g,ne).getRegex(),$t=S(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ht=S(pe).replace("(?:-->|$)","-->").getRegex(),zt=S("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ht).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Q=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Ut=S(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Q).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ge=S(/^!?\[(label)\]\[(ref)\]/).replace("label",Q).replace("ref",he).getRegex(),Ve=S(/^!?\[(ref)\](?:\[\])?/).replace("ref",he).getRegex(),Gt=S("reflink|nolink(?!\\()","g").replace("reflink",Ge).replace("nolink",Ve).getRegex(),fe={_backpedal:q,anyPunctuation:Bt,autolink:$t,blockSkip:Dt,br:ze,code:At,del:q,emStrongLDelim:Ft,emStrongRDelimAst:Pt,emStrongRDelimUnd:Mt,escape:He,link:Ut,nolink:Ve,punctuation:Ot,reflink:Ge,reflinkSearch:Gt,tag:zt,text:Nt,url:q},Vt={...fe,link:S(/^!?\[(label)\]\((.*?)\)/).replace("label",Q).getRegex(),reflink:S(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Q).getRegex()},re={...fe,escape:S(He).replace("])","~|])").getRegex(),url:S(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},qt={...re,br:S(ze).replace("{2,}","*").getRegex(),text:S(re.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},X={normal:ue,gfm:Lt,pedantic:Rt},U={normal:fe,gfm:re,breaks:qt,pedantic:Vt},Wt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ve=h=>Wt[h];function D(h,e){if(e){if(v.escapeTest.test(h))return h.replace(v.escapeReplace,ve)}else if(v.escapeTestNoEncode.test(h))return h.replace(v.escapeReplaceNoEncode,ve);return h}function Ie(h){try{h=encodeURI(h).replace(v.percentDecode,"%")}catch{return null}return h}function Le(h,e){var l;const t=h.replace(v.findPipe,(i,o,a)=>{let r=!1,c=o;for(;--c>=0&&a[c]==="\\";)r=!r;return r?"|":" |"}),n=t.split(v.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!((l=n.at(-1))!=null&&l.trim())&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(v.slashPipe,"|");return n}function G(h,e,t){const n=h.length;if(n===0)return"";let s=0;for(;s<n;){const l=h.charAt(n-s-1);if(l===e&&!t)s++;else if(l!==e&&t)s++;else break}return h.slice(0,n-s)}function jt(h,e){if(h.indexOf(e[1])===-1)return-1;let t=0;for(let n=0;n<h.length;n++)if(h[n]==="\\")n++;else if(h[n]===e[0])t++;else if(h[n]===e[1]&&(t--,t<0))return n;return-1}function Re(h,e,t,n,s){const l=e.href,i=e.title||null,o=h[1].replace(s.other.outputLinkReplace,"$1");if(h[0].charAt(0)!=="!"){n.state.inLink=!0;const a={type:"link",raw:t,href:l,title:i,text:o,tokens:n.inlineTokens(o)};return n.state.inLink=!1,a}return{type:"image",raw:t,href:l,title:i,text:o}}function Yt(h,e,t){const n=h.match(t.other.indentCodeCompensation);if(n===null)return e;const s=n[1];return e.split(`
`).map(l=>{const i=l.match(t.other.beginningSpace);if(i===null)return l;const[o]=i;return o.length>=s.length?l.slice(s.length):l}).join(`
`)}class J{constructor(e){p(this,"options");p(this,"rules");p(this,"lexer");this.options=e||H}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:G(n,`
`)}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const n=t[0],s=Yt(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:s}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){const s=G(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:G(t[0],`
`)}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let n=G(t[0],`
`).split(`
`),s="",l="";const i=[];for(;n.length>0;){let o=!1;const a=[];let r;for(r=0;r<n.length;r++)if(this.rules.other.blockquoteStart.test(n[r]))a.push(n[r]),o=!0;else if(!o)a.push(n[r]);else break;n=n.slice(r);const c=a.join(`
`),u=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${c}`:c,l=l?`${l}
${u}`:u;const d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,i,!0),this.lexer.state.top=d,n.length===0)break;const f=i.at(-1);if((f==null?void 0:f.type)==="code")break;if((f==null?void 0:f.type)==="blockquote"){const x=f,w=x.raw+`
`+n.join(`
`),_=this.blockquote(w);i[i.length-1]=_,s=s.substring(0,s.length-x.raw.length)+_.raw,l=l.substring(0,l.length-x.text.length)+_.text;break}else if((f==null?void 0:f.type)==="list"){const x=f,w=x.raw+`
`+n.join(`
`),_=this.list(w);i[i.length-1]=_,s=s.substring(0,s.length-f.raw.length)+_.raw,l=l.substring(0,l.length-x.raw.length)+_.raw,n=w.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:i,text:l}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,l={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const i=this.rules.other.listItemRegex(n);let o=!1;for(;e;){let r=!1,c="",u="";if(!(t=i.exec(e))||this.rules.block.hr.test(e))break;c=t[0],e=e.substring(c.length);let d=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,C=>" ".repeat(3*C.length)),f=e.split(`
`,1)[0],x=!d.trim(),w=0;if(this.options.pedantic?(w=2,u=d.trimStart()):x?w=t[1].length+1:(w=t[2].search(this.rules.other.nonSpaceChar),w=w>4?1:w,u=d.slice(w),w+=t[1].length),x&&this.rules.other.blankLine.test(f)&&(c+=f+`
`,e=e.substring(f.length+1),r=!0),!r){const C=this.rules.other.nextBulletRegex(w),y=this.rules.other.hrRegex(w),L=this.rules.other.fencesBeginRegex(w),P=this.rules.other.headingBeginRegex(w),O=this.rules.other.htmlBeginRegex(w);for(;e;){const se=e.split(`
`,1)[0];let z;if(f=se,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),z=f):z=f.replace(this.rules.other.tabCharGlobal,"    "),L.test(f)||P.test(f)||O.test(f)||C.test(f)||y.test(f))break;if(z.search(this.rules.other.nonSpaceChar)>=w||!f.trim())u+=`
`+z.slice(w);else{if(x||d.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||L.test(d)||P.test(d)||y.test(d))break;u+=`
`+f}!x&&!f.trim()&&(x=!0),c+=se+`
`,e=e.substring(se.length+1),d=z.slice(w)}}l.loose||(o?l.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(o=!0));let _=null,b;this.options.gfm&&(_=this.rules.other.listIsTask.exec(u),_&&(b=_[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),l.items.push({type:"list_item",raw:c,task:!!_,checked:b,loose:!1,text:u,tokens:[]}),l.raw+=c}const a=l.items.at(-1);a&&(a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd()),l.raw=l.raw.trimEnd();for(let r=0;r<l.items.length;r++)if(this.lexer.state.top=!1,l.items[r].tokens=this.lexer.blockTokens(l.items[r].text,[]),!l.loose){const c=l.items[r].tokens.filter(d=>d.type==="space"),u=c.length>0&&c.some(d=>this.rules.other.anyLine.test(d.raw));l.loose=u}if(l.loose)for(let r=0;r<l.items.length;r++)l.items[r].loose=!0;return l}}html(e){const t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){const t=this.rules.block.def.exec(e);if(t){const n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",l=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:s,title:l}}}table(e){var o;const t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;const n=Le(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),l=(o=t[3])!=null&&o.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const a of s)this.rules.other.tableAlignRight.test(a)?i.align.push("right"):this.rules.other.tableAlignCenter.test(a)?i.align.push("center"):this.rules.other.tableAlignLeft.test(a)?i.align.push("left"):i.align.push(null);for(let a=0;a<n.length;a++)i.header.push({text:n[a],tokens:this.lexer.inline(n[a]),header:!0,align:i.align[a]});for(const a of l)i.rows.push(Le(a,i.header.length).map((r,c)=>({text:r,tokens:this.lexer.inline(r),header:!1,align:i.align[c]})));return i}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const i=G(n.slice(0,-1),"\\");if((n.length-i.length)%2===0)return}else{const i=jt(t[2],"()");if(i>-1){const a=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,a).trim(),t[3]=""}}let s=t[2],l="";if(this.options.pedantic){const i=this.rules.other.pedanticHrefTitle.exec(s);i&&(s=i[1],l=i[3])}else l=t[3]?t[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),Re(t,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:l&&l.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),l=t[s.toLowerCase()];if(!l){const i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return Re(n,l,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const i=[...s[0]].length-1;let o,a,r=i,c=0;const u=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,t=t.slice(-1*e.length+i);(s=u.exec(t))!=null;){if(o=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!o)continue;if(a=[...o].length,s[3]||s[4]){r+=a;continue}else if((s[5]||s[6])&&i%3&&!((i+a)%3)){c+=a;continue}if(r-=a,r>0)continue;a=Math.min(a,a+r+c);const d=[...s[0]][0].length,f=e.slice(0,i+s.index+d+a);if(Math.min(i,a)%2){const w=f.slice(1,-1);return{type:"em",raw:f,text:w,tokens:this.lexer.inlineTokens(w)}}const x=f.slice(2,-2);return{type:"strong",raw:f,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),l=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&l&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let n,s;return t[2]==="@"?(n=t[1],s="mailto:"+n):(n=t[1],s=n),{type:"link",raw:t[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(e){var n;let t;if(t=this.rules.inline.url.exec(e)){let s,l;if(t[2]==="@")s=t[0],l="mailto:"+s;else{let i;do i=t[0],t[0]=((n=this.rules.inline._backpedal.exec(t[0]))==null?void 0:n[0])??"";while(i!==t[0]);s=t[0],t[1]==="www."?l="http://"+t[0]:l=t[0]}return{type:"link",raw:t[0],text:s,href:l,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}}class R{constructor(e){p(this,"tokens");p(this,"options");p(this,"state");p(this,"tokenizer");p(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||H,this.options.tokenizer=this.options.tokenizer||new J,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:v,block:X.normal,inline:U.normal};this.options.pedantic?(t.block=X.pedantic,t.inline=U.pedantic):this.options.gfm&&(t.block=X.gfm,this.options.breaks?t.inline=U.breaks:t.inline=U.gfm),this.tokenizer.rules=t}static get rules(){return{block:X,inline:U}}static lex(e,t){return new R(t).lex(e)}static lexInline(e,t){return new R(t).inlineTokens(e)}lex(e){e=e.replace(v.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const n=this.inlineQueue[t];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){var s,l,i;for(this.options.pedantic&&(e=e.replace(v.tabCharGlobal,"    ").replace(v.spaceLine,""));e;){let o;if((l=(s=this.options.extensions)==null?void 0:s.block)!=null&&l.some(r=>(o=r.call({lexer:this},e,t))?(e=e.substring(o.raw.length),t.push(o),!0):!1))continue;if(o=this.tokenizer.space(e)){e=e.substring(o.raw.length);const r=t.at(-1);o.raw.length===1&&r!==void 0?r.raw+=`
`:t.push(o);continue}if(o=this.tokenizer.code(e)){e=e.substring(o.raw.length);const r=t.at(-1);(r==null?void 0:r.type)==="paragraph"||(r==null?void 0:r.type)==="text"?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue.at(-1).src=r.text):t.push(o);continue}if(o=this.tokenizer.fences(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.heading(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.hr(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.blockquote(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.list(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.html(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.def(e)){e=e.substring(o.raw.length);const r=t.at(-1);(r==null?void 0:r.type)==="paragraph"||(r==null?void 0:r.type)==="text"?(r.raw+=`
`+o.raw,r.text+=`
`+o.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[o.tag]||(this.tokens.links[o.tag]={href:o.href,title:o.title});continue}if(o=this.tokenizer.table(e)){e=e.substring(o.raw.length),t.push(o);continue}if(o=this.tokenizer.lheading(e)){e=e.substring(o.raw.length),t.push(o);continue}let a=e;if((i=this.options.extensions)!=null&&i.startBlock){let r=1/0;const c=e.slice(1);let u;this.options.extensions.startBlock.forEach(d=>{u=d.call({lexer:this},c),typeof u=="number"&&u>=0&&(r=Math.min(r,u))}),r<1/0&&r>=0&&(a=e.substring(0,r+1))}if(this.state.top&&(o=this.tokenizer.paragraph(a))){const r=t.at(-1);n&&(r==null?void 0:r.type)==="paragraph"?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):t.push(o),n=a.length!==e.length,e=e.substring(o.raw.length);continue}if(o=this.tokenizer.text(e)){e=e.substring(o.raw.length);const r=t.at(-1);(r==null?void 0:r.type)==="text"?(r.raw+=`
`+o.raw,r.text+=`
`+o.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):t.push(o);continue}if(e){const r="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(r);break}else throw new Error(r)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var o,a,r;let n=e,s=null;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let l=!1,i="";for(;e;){l||(i=""),l=!1;let c;if((a=(o=this.options.extensions)==null?void 0:o.inline)!=null&&a.some(d=>(c=d.call({lexer:this},e,t))?(e=e.substring(c.raw.length),t.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);const d=t.at(-1);c.type==="text"&&(d==null?void 0:d.type)==="text"?(d.raw+=c.raw,d.text+=c.text):t.push(c);continue}if(c=this.tokenizer.emStrong(e,n,i)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),t.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),t.push(c);continue}let u=e;if((r=this.options.extensions)!=null&&r.startInline){let d=1/0;const f=e.slice(1);let x;this.options.extensions.startInline.forEach(w=>{x=w.call({lexer:this},f),typeof x=="number"&&x>=0&&(d=Math.min(d,x))}),d<1/0&&d>=0&&(u=e.substring(0,d+1))}if(c=this.tokenizer.inlineText(u)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(i=c.raw.slice(-1)),l=!0;const d=t.at(-1);(d==null?void 0:d.type)==="text"?(d.raw+=c.raw,d.text+=c.text):t.push(c);continue}if(e){const d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return t}}class K{constructor(e){p(this,"options");p(this,"parser");this.options=e||H}space(e){return""}code({text:e,lang:t,escaped:n}){var i;const s=(i=(t||"").match(v.notSpaceStart))==null?void 0:i[0],l=e.replace(v.endingNewline,"")+`
`;return s?'<pre><code class="language-'+D(s)+'">'+(n?l:D(l,!0))+`</code></pre>
`:"<pre><code>"+(n?l:D(l,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){const t=e.ordered,n=e.start;let s="";for(let o=0;o<e.items.length;o++){const a=e.items[o];s+=this.listitem(a)}const l=t?"ol":"ul",i=t&&n!==1?' start="'+n+'"':"";return"<"+l+i+`>
`+s+"</"+l+`>
`}listitem(e){var n;let t="";if(e.task){const s=this.checkbox({checked:!!e.checked});e.loose?((n=e.tokens[0])==null?void 0:n.type)==="paragraph"?(e.tokens[0].text=s+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=s+" "+D(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let l=0;l<e.header.length;l++)n+=this.tablecell(e.header[l]);t+=this.tablerow({text:n});let s="";for(let l=0;l<e.rows.length;l++){const i=e.rows[l];n="";for(let o=0;o<i.length;o++)n+=this.tablecell(i[o]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+s+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${D(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),l=Ie(e);if(l===null)return s;e=l;let i='<a href="'+e+'"';return t&&(i+=' title="'+D(t)+'"'),i+=">"+s+"</a>",i}image({href:e,title:t,text:n}){const s=Ie(e);if(s===null)return D(n);e=s;let l=`<img src="${e}" alt="${n}"`;return t&&(l+=` title="${D(t)}"`),l+=">",l}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:D(e.text)}}class me{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class A{constructor(e){p(this,"options");p(this,"renderer");p(this,"textRenderer");this.options=e||H,this.options.renderer=this.options.renderer||new K,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new me}static parse(e,t){return new A(t).parse(e)}static parseInline(e,t){return new A(t).parseInline(e)}parse(e,t=!0){var s,l;let n="";for(let i=0;i<e.length;i++){const o=e[i];if((l=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&l[o.type]){const r=o,c=this.options.extensions.renderers[r.type].call({parser:this},r);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(r.type)){n+=c||"";continue}}const a=o;switch(a.type){case"space":{n+=this.renderer.space(a);continue}case"hr":{n+=this.renderer.hr(a);continue}case"heading":{n+=this.renderer.heading(a);continue}case"code":{n+=this.renderer.code(a);continue}case"table":{n+=this.renderer.table(a);continue}case"blockquote":{n+=this.renderer.blockquote(a);continue}case"list":{n+=this.renderer.list(a);continue}case"html":{n+=this.renderer.html(a);continue}case"paragraph":{n+=this.renderer.paragraph(a);continue}case"text":{let r=a,c=this.renderer.text(r);for(;i+1<e.length&&e[i+1].type==="text";)r=e[++i],c+=`
`+this.renderer.text(r);t?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{const r='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(r),"";throw new Error(r)}}}return n}parseInline(e,t=this.renderer){var s,l;let n="";for(let i=0;i<e.length;i++){const o=e[i];if((l=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&l[o.type]){const r=this.options.extensions.renderers[o.type].call({parser:this},o);if(r!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=r||"";continue}}const a=o;switch(a.type){case"escape":{n+=t.text(a);break}case"html":{n+=t.html(a);break}case"link":{n+=t.link(a);break}case"image":{n+=t.image(a);break}case"strong":{n+=t.strong(a);break}case"em":{n+=t.em(a);break}case"codespan":{n+=t.codespan(a);break}case"br":{n+=t.br(a);break}case"del":{n+=t.del(a);break}case"text":{n+=t.text(a);break}default:{const r='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(r),"";throw new Error(r)}}}return n}}class W{constructor(e){p(this,"options");p(this,"block");this.options=e||H}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?R.lex:R.lexInline}provideParser(){return this.block?A.parse:A.parseInline}}p(W,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Zt{constructor(...e){p(this,"defaults",ae());p(this,"options",this.setOptions);p(this,"parse",this.parseMarkdown(!0));p(this,"parseInline",this.parseMarkdown(!1));p(this,"Parser",A);p(this,"Renderer",K);p(this,"TextRenderer",me);p(this,"Lexer",R);p(this,"Tokenizer",J);p(this,"Hooks",W);this.use(...e)}walkTokens(e,t){var s,l;let n=[];for(const i of e)switch(n=n.concat(t.call(this,i)),i.type){case"table":{const o=i;for(const a of o.header)n=n.concat(this.walkTokens(a.tokens,t));for(const a of o.rows)for(const r of a)n=n.concat(this.walkTokens(r.tokens,t));break}case"list":{const o=i;n=n.concat(this.walkTokens(o.items,t));break}default:{const o=i;(l=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&l[o.type]?this.defaults.extensions.childTokens[o.type].forEach(a=>{const r=o[a].flat(1/0);n=n.concat(this.walkTokens(r,t))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(l=>{if(!l.name)throw new Error("extension name required");if("renderer"in l){const i=t.renderers[l.name];i?t.renderers[l.name]=function(...o){let a=l.renderer.apply(this,o);return a===!1&&(a=i.apply(this,o)),a}:t.renderers[l.name]=l.renderer}if("tokenizer"in l){if(!l.level||l.level!=="block"&&l.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const i=t[l.level];i?i.unshift(l.tokenizer):t[l.level]=[l.tokenizer],l.start&&(l.level==="block"?t.startBlock?t.startBlock.push(l.start):t.startBlock=[l.start]:l.level==="inline"&&(t.startInline?t.startInline.push(l.start):t.startInline=[l.start]))}"childTokens"in l&&l.childTokens&&(t.childTokens[l.name]=l.childTokens)}),s.extensions=t),n.renderer){const l=this.defaults.renderer||new K(this.defaults);for(const i in n.renderer){if(!(i in l))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;const o=i,a=n.renderer[o],r=l[o];l[o]=(...c)=>{let u=a.apply(l,c);return u===!1&&(u=r.apply(l,c)),u||""}}s.renderer=l}if(n.tokenizer){const l=this.defaults.tokenizer||new J(this.defaults);for(const i in n.tokenizer){if(!(i in l))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;const o=i,a=n.tokenizer[o],r=l[o];l[o]=(...c)=>{let u=a.apply(l,c);return u===!1&&(u=r.apply(l,c)),u}}s.tokenizer=l}if(n.hooks){const l=this.defaults.hooks||new W;for(const i in n.hooks){if(!(i in l))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;const o=i,a=n.hooks[o],r=l[o];W.passThroughHooks.has(i)?l[o]=c=>{if(this.defaults.async)return Promise.resolve(a.call(l,c)).then(d=>r.call(l,d));const u=a.call(l,c);return r.call(l,u)}:l[o]=(...c)=>{let u=a.apply(l,c);return u===!1&&(u=r.apply(l,c)),u}}s.hooks=l}if(n.walkTokens){const l=this.defaults.walkTokens,i=n.walkTokens;s.walkTokens=function(o){let a=[];return a.push(i.call(this,o)),l&&(a=a.concat(l.call(this,o))),a}}this.defaults={...this.defaults,...s}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return R.lex(e,t??this.defaults)}parser(e,t){return A.parse(e,t??this.defaults)}parseMarkdown(e){return(n,s)=>{const l={...s},i={...this.defaults,...l},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&l.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=e);const a=i.hooks?i.hooks.provideLexer():e?R.lex:R.lexInline,r=i.hooks?i.hooks.provideParser():e?A.parse:A.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(n):n).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>r(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(o);try{i.hooks&&(n=i.hooks.preprocess(n));let c=a(n,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let u=r(c,i);return i.hooks&&(u=i.hooks.postprocess(u)),u}catch(c){return o(c)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){const s="<p>An error occurred:</p><pre>"+D(n.message+"",!0)+"</pre>";return t?Promise.resolve(s):s}if(t)return Promise.reject(n);throw n}}}const $=new Zt;function E(h,e){return $.parse(h,e)}E.options=E.setOptions=function(h){return $.setOptions(h),E.defaults=$.defaults,Pe(E.defaults),E};E.getDefaults=ae;E.defaults=H;E.use=function(...h){return $.use(...h),E.defaults=$.defaults,Pe(E.defaults),E};E.walkTokens=function(h,e){return $.walkTokens(h,e)};E.parseInline=$.parseInline;E.Parser=A;E.parser=A.parse;E.Renderer=K;E.TextRenderer=me;E.Lexer=R;E.lexer=R.lex;E.Tokenizer=J;E.Hooks=W;E.parse=E;E.options;E.setOptions;E.use;E.walkTokens;E.parseInline;const Xt=E;A.parse;R.lex;class Qt{constructor(e,t=null,n=!0){p(this,"_isSaved",!0);p(this,"allowEdit",!0);this.root=e,this.onSave=t,t==null&&(this.allowEdit=!1),n&&t!=null&&document.addEventListener("keydown",s=>{s.ctrlKey&&s.key==="s"&&(s.preventDefault(),this.save())})}async load(e,t=!1){if(!this._isSaved&&!t)return!1;this.root.innerHTML="",this._isSaved=!0;let n=this.render(e);for(let s of n)this.root.appendChild(await s);return!0}save(){let e=this.getText();this.onSave==null?this.isSaved()||alert("ERROR: This should not happen! Documents should not be editable if onSave is null."):this.onSave(e).then(()=>{e==this.getText()&&(this._isSaved=!0)})}getText(){let e="";for(let t of this.root.children)e+=t.getAttribute("data-text")+`

`;for(;e.endsWith(`

`);)e=e.slice(0,e.length-1);return e}isSaved(){return this._isSaved}pluginCreateChunk(e){return e}onDirty(){}pluginOpenEditor(e,t){return null}render(e){let t=e.split(`

`);const n=[];for(let s=0;s<t.length;s++){let l=t[s];if(l.startsWith("```"))for(;s+1<t.length&&(s++,l+=`

`+t[s],!t[s].includes("```")););n.push(this.createChunk(l))}return n}async createChunk(e){let t=document.createElement("div");return t.classList.add("chunk"),e=this.pluginCreateChunk(e),t.innerHTML=await Xt(e),t.onclick=n=>{this.allowEdit&&this.openEditor(t)},t.setAttribute("data-text",e),t}openEditor(e){let t=e.getAttribute("data-text"),n=this;async function s(a){if(a!=""){let r=n.render(a);for(let c of r)n.root.insertBefore(await c,i)}n.root.removeChild(i),a!=t&&(n._isSaved=!1,n.onDirty())}let l=this.pluginOpenEditor(t,s);if(l!=null){l.setAttribute("data-text",t),this.root.replaceChild(l,e);return}let i=document.createElement("textarea");i.classList.add("editorChunk"),i.placeholder="Add markdown text here!",i.value=t,i.style.height=t.split(`
`).length*1.2+.2+"em",window.setTimeout(()=>{i.style.height="0px",i.style.height=i.scrollHeight+"px"},10),i.setAttribute("data-text",t),i.addEventListener("paste",async a=>{var c,u,d;const r=typeof((c=navigator==null?void 0:navigator.clipboard)==null?void 0:c.read)=="function"?await navigator.clipboard.read():a.clipboardData.files;for(const f of r)if(f instanceof File&&((u=f.type)!=null&&u.startsWith("image/")))o(f),a.preventDefault();else if(f instanceof ClipboardItem){const x=(d=f.types)==null?void 0:d.filter(w=>w.startsWith("image/"));for(const w of x)o(await f.getType(w)),a.preventDefault()}});const o=a=>{var r=new FileReader;r.readAsDataURL(a),r.onloadend=function(){var c=r.result;let u="![pasted image]("+c+")";if(i.selectionStart||i.selectionStart==0){var d=i.selectionStart,f=i.selectionEnd;i.value=i.value.substring(0,d)+u+i.value.substring(f,i.value.length)}else i.value+=u}};this.root.replaceChild(i,e),i.focus(),i.setSelectionRange(t.length,t.length),i.onkeyup=()=>{i.setAttribute("data-text",i.value),i.style.height="0px",i.style.height=i.scrollHeight+"px"},i.onblur=a=>{s(i.value)},i.addEventListener("keydown",a=>{(a.ctrlKey||a.shiftKey)&&a.key==="Enter"&&i.blur()})}}const Jt=["txt","csv","json","yaml","py","ts","js","rs","c","h","hpp","cpp","sh","bat"];class Kt extends k{constructor(){super("div","","editPage")}async update(e,t){let n=I.connections.get(e.sessionName);if(n==null){N.open("login",{});return}this.htmlElement.innerHTML="";let s=e.folder+"/"+e.filename,l=e.filename.split("."),i=l[l.length-1].toLowerCase(),o=await n.md5(s);if(o==null&&(alert(m.EDIT_READ_FILE_ERROR),N.back()),i=="png"||i=="jpg"||i=="jpeg"||i=="tiff"||i=="tif"){let a=new k("div","","editNavbar"),r=new T(V,"editNavbarButton");r.onClick=()=>{history.back()},r.setClass("left"),a.add(r);let c=new T(oe,"editNavbarButton");c.setClass("right"),c.onClick=()=>{alert("Not yet implemented!")},a.add(c);let u=new k("div",e.filename,"editNavbarTitle");a.add(u),this.add(a);let d=new k("div","","editImageBackground"),f=new k("img","","editImageView"),x=i=="tiff"||i=="tif"?-1:0;f.htmlElement.src=n.readURL(s,x),f.htmlElement.onload=()=>{let w=f.htmlElement.width,_=f.htmlElement.height,b=window.innerWidth,C=window.innerHeight,y=w/b,L=_/C,P=y>L?y:L;f.htmlElement.width=w/P,f.htmlElement.height=_/P},d.add(f),this.add(d)}else if(i=="md"){let a=new k("div","","editNavbar"),r=new T(V,"editNavbarButton");r.setClass("left"),a.add(r);let c=new k("div",e.filename,"editNavbarTitle");a.add(c);let u=new T(Ae,"editNavbarButton");u.setClass("right"),a.add(u);let d=new T(Te,"editNavbarButton");d.setClass("left"),d.hide(),a.add(d),this.add(a);let f=await n.readTxt(s);if(f==null||o==null){alert(m.EDIT_READ_FILE_ERROR);return}let x=new k("div","","editTextOutput"),w=new k("div","","mdOutput");x.add(w),this.add(x);let _=new Qt(w.htmlElement,async b=>{if(n==null)return!1;if(!await n.putTxt(s,b,o))alert(m.EDIT_SAVE_FILE_ERROR);else{_.getText()==b&&d.hide();let y=await n.md5(s);if(y==null)return alert(m.EDIT_READ_MD5_ERROR),!1;o=y}return!0});_.load(f),_.onDirty=()=>{d.show()},d.onClick=async()=>{_.save()},r.onClick=()=>{if(_.isSaved())history.back();else{let b=new le("popupContent","popupContainer",m.EDIT_EXIT_WITHOUT_SAVE_QUESTION,m.EDIT_EXIT_WITHOUT_SAVE_CONTINUE_EDITING,m.EDIT_EXIT_WITHOUT_SAVE_EXIT);b.onConfirm=()=>{b.dispose()},b.onCancel=()=>{history.back()}}}}else if(Jt.includes(i)){let a=!1,r=new k("div","","editNavbar"),c=new T(V,"editNavbarButton");c.setClass("left"),r.add(c);let u=new k("div",e.filename,"editNavbarTitle");r.add(u);let d=new T(Ce,"editNavbarButton");d.setClass("right"),r.add(d);let f=new T(Te,"editNavbarButton");f.setClass("left"),f.hide(),r.add(f),this.add(r);let x=await n.readTxt(s);if(x==null||o==null){alert(m.EDIT_READ_FILE_ERROR);return}x=x.replaceAll(`\r
`,`
`);let w=new k("div","","editTextOutput");w.htmlElement.innerHTML=x.replaceAll(`
`,"<BR>"),w.htmlElement.style.paddingTop="1em",this.add(w);let _=new k("textarea","","editTextOutputEdit");_.htmlElement.value=x,_.htmlElement.style.resize="none",_.hide(),_.htmlElement.oninput=()=>{_.htmlElement.value.replaceAll(`\r
`,`
`)==x?f.hide():f.show()},this.add(_),f.onClick=async()=>{if(n==null)return;let b=_.htmlElement.value.replaceAll(`\r
`,`
`);if(!await n.putTxt(s,b,o))alert(m.EDIT_SAVE_FILE_ERROR);else{x=b,_.htmlElement.value.replaceAll(`\r
`,`
`)==x&&f.hide();let y=await n.md5(s);if(y==null){alert(m.EDIT_READ_MD5_ERROR);return}o=y}},d.onClick=()=>{a=!a,a?(d.htmlElement.innerHTML=ut,w.hide(),_.show()):(d.htmlElement.innerHTML=Ce,w.htmlElement.innerHTML=_.htmlElement.value.replaceAll(`
`,"<BR>"),w.show(),_.hide())},c.onClick=()=>{if(_.htmlElement.value.replaceAll(`\r
`,`
`)==x)history.back();else{let b=new le("popupContent","popupContainer",m.EDIT_EXIT_WITHOUT_SAVE_QUESTION,m.EDIT_EXIT_WITHOUT_SAVE_CONTINUE_EDITING,m.EDIT_EXIT_WITHOUT_SAVE_EXIT);b.onConfirm=()=>{b.dispose()},b.onCancel=()=>{history.back()}}}}else if(i=="pdf"){let a=new k("iframe","","editIFrame");a.htmlElement.name="editIFrame",this.add(a),n.read(s,"editIFrame")}else{let a=new k("div","","editNavbar"),r=new T(V,"editNavbarButton");r.onClick=()=>{history.back()},r.setClass("left"),a.add(r);let c=new k("div",e.filename,"editNavbarTitle");a.add(c),this.add(a);let u=new k("div","","editUnsupportedDocument"),d=new k("div",m.EDIT_DOWNLOAD_HEADING,"editHeading");u.add(d);let f=new T(m.EDIT_DOWNLOAD_BTN,"buttonWide");f.htmlElement.href=n.readURL(s),console.log(e.filename),u.add(f);let x=new T(m.EDIT_OPEN_NATIVELY,"buttonWide");f.htmlElement.href.includes("localhost")&&(x.htmlElement.href=f.htmlElement.href.replace("read","open"),u.add(x));let w=new k("div",m.EDIT_UPLOAD_HEADING,"editHeading");u.add(w);let _=new B("editUploadFile","","file","editUploadFile");u.add(_);let b=new T(oe,"buttonWide");b.onClick=async()=>{if(n==null)return;b.htmlElement.disabled=!0;let C=_.htmlElement.files[0],y=await n.putFile(s,C,o);b.htmlElement.disabled=!1,y?(_.value(""),o=await n.md5(s)):alert(m.UPLOAD_FAILED)},u.add(b),this.add(u)}}hide(){super.hide()}}async function en(){je(),Je("kb"),document.getElementsByTagName("title")[0].innerHTML=m.APPNAME,localStorage.kb_autologin=="true"&&De(),new N("search&q=/",{search:new mt,login:new Ke,edit:new Kt})}en();
