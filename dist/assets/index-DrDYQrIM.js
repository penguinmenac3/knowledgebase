var Ye=Object.defineProperty;var Ze=(h,t,e)=>t in h?Ye(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var u=(h,t,e)=>Ze(h,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class f{constructor(){}static APPLY_COUNTED(t,e){return e.replace("{count}",t.toString())}}u(f,"TIME_LOCALE","en"),u(f,"TIME_YESTERDAY","yesterday"),u(f,"TIME_HOURS_AGO","{count} hour(s) ago"),u(f,"TIME_MINUTES_AGO","{count} minute(s) ago"),u(f,"TIME_SECONDS_AGO","{count} second(s) ago"),u(f,"TIME_TODAY_AT","today at"),u(f,"TIME_JUST_NOW","just now"),u(f,"APPNAME","Knowledgebase"),u(f,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),u(f,"LOGIN_SESSION_NAME","Session Name"),u(f,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),u(f,"LOGIN_API_TOKEN_LABEL","API Token"),u(f,"LOGIN_SUBMIT","Add Connection"),u(f,"LOGIN_ALL_CONNECTIONS","All"),u(f,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),u(f,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),u(f,"LOGIN_OFFLINE_MODAL_QUESTION","Cannot connect to server. Do you want to continue in offline mode? Offline mode might show you outdated files and data."),u(f,"LOGIN_OFFLINE_MODAL_CONFIRM","Continue offline"),u(f,"LOGIN_OFFLINE_MODAL_CANCEL","Return to login"),u(f,"FILETREE_MISSING_CONNECTIONS","Add a server via settings!"),u(f,"FILETREE_FILETREE_IS_NULL","Cannot retrieve filetree. Maybe you have a weak internet connection?"),u(f,"FILETREE_SEARCH_PLACEHOLDER","Search (Keyword, Keyword)"),u(f,"FILETREE_OFFLINE","Offline:"),u(f,"FILETREE_MORE_RESULTS","Show more results!"),u(f,"FILETREE_DELETE_QUESTION","Are you sure you want to delete this file?"),u(f,"FILETREE_DELETE_CONFIRM","Delete"),u(f,"FILETREE_DELETE_CANCEL","Keep File"),u(f,"FILETREE_RENAME_CURRENT_PATH","Current Path"),u(f,"FILETREE_RENAME_NEW_PATH","New Path"),u(f,"FILETREE_RENAME_CONFIRM","Rename"),u(f,"FILETREE_INVALID_SESSION","You appear to have a broken session. Try to remove it and add it again."),u(f,"SETTINGS_TITLE","Settings"),u(f,"SETTINGS_GENERAL","General"),u(f,"SETTINGS_LIST_CONNECTIONS","Connections"),u(f,"SETTINGS_ADD_CONNECTION","Add New Connection"),u(f,"SETTINGS_REMOVE_CONNECTION","delete"),u(f,"SETTINGS_REMOVE_CONNECTION_QUESTION","Are you sure you want to delete this connection?"),u(f,"SETTINGS_REMOVE_CONNECTION_CONFIRM","Yes, delete this connection."),u(f,"SETTINGS_REMOVE_CONNECTION_CANCEL","No, keep this connection."),u(f,"UPLOAD_TITLE","Upload File"),u(f,"UPLOAD_SERVER","Server"),u(f,"UPLOAD_FOLDERNAME","Foldername"),u(f,"UPLOAD_LOCATION","Location: "),u(f,"UPLOAD_FILENAME","Filename"),u(f,"UPLOAD_FILE","File"),u(f,"UPLOAD_FILE_OPTIONAL","File (optional)"),u(f,"UPLOAD_SEND","Upload File"),u(f,"UPLOAD_MARKDOWN","Empty File"),u(f,"UPLOAD_FAILED","Upload failed. Reasons could be: The file already exists, the folder is invalid or the server is currently unreachable."),u(f,"VIEWER_READ_FILE_ERROR","Cannot read file or reach server. Maybe your internet connection is too weak or the server is down."),u(f,"VIEWER_SAVE_FILE_ERROR","Cannot save file. It was either changed on the server or you have too weak internet."),u(f,"VIEWER_READ_MD5_ERROR","Cannot read md5 of file. Maye there was an error saving or your internet is weak."),u(f,"VIEWER_EXIT_WITHOUT_SAVE_QUESTION","You did not save your changes. Do you want to exit anyways or continue editing?"),u(f,"VIEWER_EXIT_WITHOUT_SAVE_EXIT","Exit (Discard Changes)"),u(f,"VIEWER_EXIT_WITHOUT_SAVE_CONTINUE_EDITING","Continue Editing"),u(f,"VIEWER_LOAD_HERE_FILE","Open (here)"),u(f,"VIEWER_UPLOAD_HEADING","Update File"),u(f,"VIEWER_UPLOAD_BTN","Upload"),u(f,"VIEWER_UNSAVED_CHANGES","You cannot open a new file while having a file with unsaved changes open!"),u(f,"MD_EMPTY_CELL","Empty, click to add text!");class J extends f{}u(J,"TIME_LOCALE","de"),u(J,"APPNAME","Wissensdatenbank");let d=f;function Xe(){switch(localStorage.language){case"de":d=J;break;case"en":case"us":default:d=f;break}}const j=class j{constructor(t){u(this,"apiEndpoint","");u(this,"sessionToken","");this.session_name=t,this.loadSessionConfig(),j.connections.set(t,this)}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let t=JSON.parse(localStorage.webfs_sessions);if(this.session_name in t){let e=t[this.session_name];this.apiEndpoint=e.apiEndpoint,this.sessionToken=e.sessionToken}}}writeSessionConfig(t,e){this.apiEndpoint=t,this.sessionToken=e;let n={};localStorage.webfs_sessions&&(n=JSON.parse(localStorage.webfs_sessions)),n[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:e},localStorage.webfs_sessions=JSON.stringify(n)}removeSession(){if(localStorage.webfs_sessions){let t=JSON.parse(localStorage.webfs_sessions);delete t[this.session_name],localStorage.webfs_sessions=JSON.stringify(t)}}async request(t){t.append("token",this.sessionToken);const e={method:"POST",body:t};try{return await fetch(this.apiEndpoint,e)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let t=new FormData;t.append("cmd","ping"),t.append("uri",".");let e=await this.request(t);return e==null?!1:e.status!=200?(console.error(e.text()),!1):await e.text()=="pong"}async login(t,e){let n=new FormData;n.append("cmd","login"),n.append("uri","."),n.append("token",e);const s={method:"POST",body:n};let i;try{i=await fetch(t,s)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(i.status!=200)return console.error(i.text()),!1;let l=await i.text();return this.writeSessionConfig(t,l),!0}buildFileTree(t){return t}async list(t){let e=new FormData;e.append("cmd","list"),e.append("uri",t);let n=await this.request(e);return n==null?null:n.status!=200?(console.error(n.text()),null):await n.json()}async walk(t){let e=new FormData;e.append("cmd","walk"),e.append("uri",t);let n=await this.request(e);if(n==null)return null;if(n.status!=200)return console.error(n.text()),null;let s=await n.json();return this.buildFileTree(s)}async md5(t){let e=new FormData;e.append("cmd","md5"),e.append("uri",t);let n=await this.request(e);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}async open(t){let e=new FormData;e.append("cmd","open"),e.append("uri",t);let n=await this.request(e);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async readTxt(t){let e=new FormData;e.append("cmd","read"),e.append("uri",t);let n=await this.request(e);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}readURL(t,e=0){let n="";return e!=0&&(n="&subsample=1&width="+e.toFixed(0)+"&height="+e.toFixed(0)),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(t)+n}read(t,e="_self"){function n(l,r,o){let a=document.createElement("input");a.type="hidden",a.name=r,a.value=o,l.appendChild(a)}let s=document.getElementsByTagName("body")[0],i=document.createElement("form");i.action=this.apiEndpoint,i.method="post",i.target=e,n(i,"cmd","read"),n(i,"token",this.sessionToken),n(i,"uri",t),s.appendChild(i),i.submit(),s.removeChild(i)}async putTxt(t,e,n){var s=new Blob([e],{type:"text/plain;charset=utf-8"});return this.putFile(t,s,n)}async putFile(t,e,n){let s="",i=new FormData;i.append("cmd","write"),i.append("operation","write"),i.append("uri",t),i.append("file",e),i.append("md5",n+","+s);let l=await this.request(i);return l==null?!1:l.status!=200?(console.error(l.text()),!1):(await l.text(),!0)}async mkdir(t){let e=new FormData;e.append("cmd","write"),e.append("operation","mkdir"),e.append("uri",t);let n=await this.request(e);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rmdir(t){let e=new FormData;e.append("cmd","write"),e.append("operation","rmdir"),e.append("uri",t);let n=await this.request(e);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async mv(t,e){let n=new FormData;n.append("cmd","write"),n.append("operation","mv"),n.append("uri",t),n.append("target",e);let s=await this.request(n);return s==null?!1:s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}async rm(t,e){let n=new FormData;n.append("cmd","write"),n.append("operation","rm"),n.append("uri",t),n.append("md5",e);let s=await this.request(n);return s==null?!1:s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}};u(j,"connections",new Map);let S=j;class w{constructor(t,e="",n=""){u(this,"parent",null);u(this,"htmlElement");u(this,"displayStyle","none");this.htmlElement=document.createElement(t),this.htmlElement.innerHTML=e,n!=""&&this.setClass(n)}add(t){this.htmlElement.appendChild(t.htmlElement),t.parent=this}addHtml(t,e,n=""){const s=document.createElement(t);return s.innerHTML=e,n!=""&&s.classList.add(n),this.htmlElement.appendChild(s),s}remove(t){this.htmlElement.removeChild(t.htmlElement),t.parent=null}removeHTML(t){this.htmlElement.removeChild(t)}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(t,e){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(t){this.hasClass(t)||this.htmlElement.classList.add(t)}unsetClass(t){this.hasClass(t)&&this.htmlElement.classList.remove(t)}hasClass(t){return this.htmlElement.classList.contains(t)}}class _ extends w{constructor(e,n="button"){super("a",e,n);u(this,"disabled",!1);this.htmlElement.onclick=s=>{this.disabled||(s.stopPropagation(),this.onClick())}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}disable(){this.disabled=!0,this.setClass("disabled")}enable(){this.disabled=!1,this.unsetClass("disabled")}}class Qe extends w{constructor(t,...e){super("div","",t);for(const n of e)this.add(n)}submit(){let t=new FormData;for(const e in this.htmlElement.children){let n=this.htmlElement.children[e];n instanceof HTMLInputElement&&t.append(n.name,n.value)}this.onSubmit(t)}onSubmit(t){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(t)}}class N extends w{constructor(t,e,n,s="formInput"){super("input","",s),this.htmlElement.name=t,this.htmlElement.placeholder=e,this.htmlElement.type=n,this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(t=void 0){return t!==void 0&&(this.htmlElement.value=t),this.htmlElement.value}onChange(t){}onChangeDone(t){}}class R extends w{constructor(t,e="formLabel"){super("label",t,e)}}class Ke extends _{onClick(){this.parent.submit()}}class v{constructor(t,e){u(this,"currentPage","");var n;this.defaultPage=t,this.pages=e;for(const s in e)(n=document.getElementById("app"))==null||n.appendChild(e[s].htmlElement),e[s].hide();window.onhashchange=s=>{this.onOpen()},location.hash.slice(1)==""?location.hash="#"+t:this.onOpen()}onOpen(){var l,r,o;let t={},e=location.hash.slice(1);e.length==0&&(e=this.defaultPage);let n=e.split("&"),s=n[0];n=n.splice(1);for(const a of n){let c=a.split("="),p=decodeURIComponent(c[0]),m=decodeURIComponent(c[1]);t[p]=m}let i=this.currentPage!=s;i&&((l=this.pages[this.currentPage])==null||l.hide(),this.currentPage=s,(r=this.pages[this.currentPage])==null||r.show()),(o=this.pages[this.currentPage])==null||o.update(t,i)}static open(t,e){window.setTimeout(()=>{let n="";for(let s in e)n+="&"+encodeURIComponent(s)+"="+encodeURIComponent(e[s]);location.hash="#"+encodeURIComponent(t)+n},200)}static update(t){let n=location.hash.slice(1).split("&"),s=n[0];n=n.splice(1);for(const i of n){let l=i.split("="),r=decodeURIComponent(l[0]),o=decodeURIComponent(l[1]);t.hasOwnProperty(r)||(t[r]=o)}window.setTimeout(()=>{let i="";for(let l in t)i+="&"+encodeURIComponent(l)+"="+encodeURIComponent(t[l]);location.hash="#"+encodeURIComponent(s)+i},200)}static back(){history.back()}}u(v,"DEBUG",!1);let Je='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>',et='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 128 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z"/></svg>',Ae='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 352 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>';class Fe extends w{constructor(e,n){var s;super("div");u(this,"container");this.setClass(e),this.container=new w("div"),this.container.setClass(n),this.container.add(this),(s=document.getElementById("global"))==null||s.appendChild(this.container.htmlElement)}dispose(){var e;this.onExit(),(e=document.getElementById("global"))==null||e.removeChild(this.container.htmlElement)}onExit(){}update(){}}class ne extends Fe{constructor(t,e,n,s,i){super(t,e),this.add(new w("p",n));let l=new _(s,"popupConfirmBtn");l.onClick=()=>{this.dispose(),this.onConfirm()},this.add(l);let r=new _(i,"popupCancelBtn");r.onClick=()=>{this.dispose(),this.onCancel()},this.add(r)}onConfirm(){console.log("ConfirmCancelPopup::onConfirm not implemented. Must be implemented by subclass.")}onCancel(){console.log("ConfirmCancelPopup::onCancel not implemented. Must be implemented by subclass.")}}class Y extends Fe{constructor(t="popupContent",e="popupContainer",n="popupExitBtn"){super(t,e);let s=new _(Ae,n);s.onClick=this.dispose.bind(this),this.add(s)}update(){}}let P="webfs";function tt(h){P=h}function nt(){let h=new Qe("form",new R(d.LOGIN_SESSION_NAME),new N("sessionName","myserver","text"),new R(d.LOGIN_API_ENDPOINT_LABEL),new N("apiEndpoint","https://myserver/webfs/api.php","url"),new R(d.LOGIN_API_TOKEN_LABEL),new N("apiToken","a4ef9...","password"),new Ke(d.LOGIN_SUBMIT,"buttonWide"));return h.onSubmit=st,h}async function st(h){let t=h.get("sessionName"),e=h.get("apiEndpoint"),n=h.get("apiToken");if(t==""||e==""||n==""||t==null||e==null||n==null){alert(d.LOGIN_ERROR_MISSING_INPUTS);return}if(await new S(t).login(e,n)){let i=[];localStorage[P+"_sessions"]&&(i=JSON.parse(localStorage[P+"_sessions"])),i.push(t),localStorage[P+"_sessions"]=JSON.stringify(i),v.back()}else S.connections.delete(t),alert(d.LOGIN_ERROR_LOGIN_FAILED)}function it(){if(localStorage[P+"_sessions"]){let h=JSON.parse(localStorage[P+"_sessions"]);if(h.length>0)for(let t of h)new S(t)}}function we(){return window.innerWidth<768}const A=class A extends w{constructor(e,n,s,i="master-detail-view"){super("div","",i);u(this,"isSidepanelResizing",!1);u(this,"isMasterResizing",!1);u(this,"preferredView","master");u(this,"master");u(this,"detail");u(this,"sidepanel",null);u(this,"leftHandleWidth",0);u(this,"rightHandleWidth",0);this.masterContent=e,this.detailContent=n,this.sidepanelContent=s,this.master=new w("div","","master"),this.detail=new w("div","","detail"),window.setTimeout(()=>{let l=getComputedStyle(this.detail.htmlElement);this.leftHandleWidth=parseFloat(l.getPropertyValue("border-left-width")),this.rightHandleWidth=parseFloat(l.getPropertyValue("border-right-width")),this.adjustLayout()},100),this.setupLayout(),this.addEventListeners()}setupLayout(){this.master.add(this.masterContent),this.add(this.master),this.detail.add(this.detailContent),this.add(this.detail),this.sidepanelContent!=null&&(this.sidepanel=new w("div","","sidepanel"),this.sidepanel.add(this.sidepanelContent),this.add(this.sidepanel))}addEventListeners(){window.addEventListener("resize",()=>this.adjustLayout()),this.detail.htmlElement.addEventListener("mousedown",e=>this.startResizing(e)),window.addEventListener("mousemove",e=>this.onResize(e)),window.addEventListener("mouseup",()=>this.endResizing()),document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.key==="B"){e.preventDefault();let[n,s]=this.getStoredPanelSizes();e.altKey?s>0?s=0:s=30:n>0?n=0:n=30,localStorage.setItem("webui_masterDetailViewPanelSizes",`${n},${s}`),this.adjustLayout()}})}update(e,n){var s;this.masterContent.update(e,n),this.detailContent.update(e,n),(s=this.sidepanelContent)==null||s.update(e,n)}setPreferedView(e){if(!["master","detail"].includes(e))throw new Error("Invalid preferred view. Please choose 'master' or 'detail'.");this.preferredView=e,this.adjustLayout()}adjustLayout(){we()?this.adjustLayoutForSmallScreens():this.adjustLayoutForLargeScreens()}adjustLayoutForSmallScreens(){var e;this.detail.htmlElement.style.borderLeftWidth="0px",this.detail.htmlElement.style.borderRightWidth="0px",this.preferredView==="detail"?(this.master.hide(),this.detail.show()):(this.detail.hide(),this.master.show()),(e=this.sidepanel)==null||e.hide(),this.detail.htmlElement.style.width="100%",this.master.htmlElement.style.width="100%"}adjustLayoutForLargeScreens(){var s,i,l;this.detail.htmlElement.style.borderLeftWidth="",this.detail.htmlElement.style.borderRightWidth="",this.master.show(),this.detail.show(),(s=this.sidepanel)==null||s.show();let[e,n]=this.getStoredPanelSizes();[e,n]=this.autohideSmallPanels(e,n),this.master.htmlElement.style.width=`${e}%`,e==0?this.masterContent.hide():this.masterContent.show(),this.sidepanel!=null&&(this.sidepanel.htmlElement.style.width=`${n}%`,n==0?(i=this.sidepanelContent)==null||i.hide():(l=this.sidepanelContent)==null||l.show()),this.detail.htmlElement.style.width=100-(e+n)+"%"}getStoredPanelSizes(){let e=localStorage.getItem("webui_masterDetailViewPanelSizes");e||(e="30,0");let[n,s]=e.split(",").map(Number);return this.sidepanel==null&&(s=0),[n,s]}autohideSmallPanels(e,n){const s=this.htmlElement.clientWidth;return e*s/100<A.MIN_PANEL_WIDTH&&(e=0),n*s/100<A.MIN_PANEL_WIDTH&&(n=0),[e,n]}startResizing(e){if(we())return;const n=this.detail.htmlElement.getBoundingClientRect();e.clientX-n.left<=this.leftHandleWidth&&(this.isMasterResizing=!0,e.preventDefault()),n.right-e.clientX<=this.rightHandleWidth&&(this.isSidepanelResizing=!0,e.preventDefault())}onResize(e){if(!this.isMasterResizing&&!this.isSidepanelResizing)return;const n=this.htmlElement.clientWidth;let[s,i]=this.getStoredPanelSizes();this.isMasterResizing?(s=e.clientX/n*100,s=Math.max(0,Math.min(s,50)),s<A.MIN_PANEL_WIDTH/n*100&&(s=0)):this.isSidepanelResizing&&(i=100-e.clientX/n*100,i=Math.max(0,Math.min(i,50)),i<A.MIN_PANEL_WIDTH/n*100&&(i=0)),localStorage.setItem("webui_masterDetailViewPanelSizes",`${s},${i}`),this.adjustLayout()}endResizing(){this.isMasterResizing=!1,this.isSidepanelResizing=!1}};u(A,"MIN_PANEL_WIDTH",200);let ee=A;const lt=6,rt=6,ot=10,at=12,ct=.001,Ee=31557600,ke=2629800,be=86400,xe=3600,_e=60;function ht(h,t="long"){let e=new Date;const n=Te(e,h),{hours:s,minutes:i,seconds:l}=n;let r=new Date(e.toISOString().substring(0,10)),o=new Date(h.toISOString().substring(0,10));const a=Te(r,o),{years:c,months:p,days:m}=a;return c>100?"unknown":c>0||p>rt?ye(h,{includeYear:!0,length:t}):p>0||m>lt?ye(h,{includeYear:!1,length:t}):m>1?h.toLocaleDateString(d.TIME_LOCALE,{weekday:t}):m===1?d.TIME_YESTERDAY:s>at?d.TIME_TODAY_AT+" "+h.toLocaleTimeString(d.TIME_LOCALE,{hour:"numeric",minute:"2-digit"}):s>0?d.APPLY_COUNTED(s,d.TIME_HOURS_AGO):i>0?d.APPLY_COUNTED(i,d.TIME_MINUTES_AGO):l>ot?d.APPLY_COUNTED(l,d.TIME_SECONDS_AGO):d.TIME_JUST_NOW}function ye(h,{includeYear:t,length:e}){const n=h.toLocaleDateString(d.TIME_LOCALE,{month:e});let i=`${h.getDate().toString()}. ${n}`;return t&&(i+=` ${h.getFullYear()}`),i}function Se(h){return Math.floor(h*ct)}function Te(h,t){const e={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};let n=Se(h.valueOf())-Se(t.valueOf());return e.years=Math.floor(n/Ee),n-=e.years*Ee,e.months=Math.floor(n/ke),n-=e.months*ke,e.days=Math.floor(n/be),n-=e.days*be,e.hours=Math.floor(n/xe),n-=e.hours*xe,e.minutes=Math.floor(n/_e),n-=e.minutes*_e,e.seconds=n,e}class ut extends Y{constructor(){super("popupContent-fullscreen","popupContainer","popupExitBtn"),this.add(new w("div",d.SETTINGS_TITLE,"popupTitle")),this.add(new w("div",d.SETTINGS_LIST_CONNECTIONS,"popupSubtitle")),S.connections.forEach(t=>{let e=t.getSessionName(),n=new _(d.SETTINGS_REMOVE_CONNECTION);n.setClass("buttonBad"),n.onClick=()=>{let i=new ne("popupContent","popupContainer",d.SETTINGS_REMOVE_CONNECTION_QUESTION,d.SETTINGS_REMOVE_CONNECTION_CONFIRM,d.SETTINGS_REMOVE_CONNECTION_CANCEL);i.onConfirm=()=>{let l=JSON.parse(localStorage.kb_sessions);l=l.filter(r=>r!==e),localStorage.kb_sessions=JSON.stringify(l),t.removeSession(),location.reload()},i.show()};let s=new w("div","","popupServer");s.addHtml("div",e,"settingsServerName"),s.add(n),this.add(s)}),this.add(new w("div",d.SETTINGS_ADD_CONNECTION,"popupSubtitle")),this.add(nt())}update(){}}function De(h){let t=h.split("/"),e=t.pop(),n=t.join("/");return n==""&&(n="."),{filename:e,folder:n}}class pt extends w{constructor(t,e,n,s,i,l){super("div","","searchResult");let{filename:r,folder:o}=De(t),a=o;a=="."&&(a=""),this.htmlElement.innerHTML=r+"<BR><span class='searchResultInfo'>"+e+"/"+a+"</span>";let c=r.split(".");s&&c.push("DIR"),this.htmlElement.onclick=()=>{if(s)i.htmlElement.value="/"+t,i.onChange(i.htmlElement.value),i.onChangeDone(i.htmlElement.value);else{let p=e+":"+o+"/"+r;v.update({view:p})}}}}function dt(h,t){let e=[];for(let[n,s]of h)e=e.concat(Pe(n,s));return e=gt(e),e=mt(e),e=ft(e,t),e}function ft(h,t){let e=t.toLowerCase().split(",").map(i=>i.trim()),n=[];for(let i of h){let{filename:l,folder:r}=De(i.filepath);l=l.toLowerCase(),r=r.toLowerCase();var s=0;for(let o of e){if(o==""){s+=1;continue}let a=o.startsWith("/"),c=o.substring(1);c==""&&(c="."),!a&&l.includes(o)&&(s+=100,i.isFolder&&(s+=10)),a&&i.isFolder&&l.includes(c)&&i.filepath.toLowerCase()!=c&&(s+=125,l==c&&(s+=25)),a&&r==c&&(s+=100,i.isFolder&&(s+=10))}s>0&&(l.includes(".fav")&&(s+=3),l.includes(".todo")&&(s+=4),n.push({filepath:i.filepath,sessionName:i.sessionName,modified:i.modified,isFolder:i.isFolder,score:s}))}return n.sort((i,l)=>l.score-i.score)}function mt(h){return h.sort((t,e)=>t.modified==null?1:e.modified==null?-1:e.modified.toISOString().localeCompare(t.modified.toISOString()))}function gt(h){return h.sort((t,e)=>t.filepath==null?1:e.filepath==null?-1:t.filepath.localeCompare(e.filepath))}function Pe(h,t,e="",n=[]){for(const i in t){var s=t[i];typeof s!="string"?(n=Pe(h,s,e+i+"/",n),n.push({filepath:e+i,sessionName:h,modified:null,isFolder:!0})):(s.indexOf("GMT")<0&&(s+=" GMT+0000"),n.push({filepath:e+i,sessionName:h,modified:new Date(s),isFolder:!1}))}return n}class wt extends Y{constructor(t,e,n){super("popupContent-fullscreen","popupContainer","popupExitBtn"),this.setClass("upload");let s=t.split(":")[0],i=t.split(":")[1];this.add(new w("div",d.UPLOAD_TITLE,"popupTitle")),this.add(new R(d.UPLOAD_SERVER+": "+s)),this.add(new R(d.UPLOAD_FOLDERNAME+": "+i)),this.add(new R(d.UPLOAD_FILENAME));let l=new N("filename",e,"text");l.value(e),this.add(l);let r=new _(d.UPLOAD_MARKDOWN,"buttonWide");r.onClick=async()=>{let c=S.connections.get(s);if(c==null)return;a.disable(),r.disable(),i.endsWith("/")&&(i=i.slice(0,i.length-1));let p=l.value(),m=i+"/"+p,g=await c.putTxt(m,"","");a.enable(),r.enable(),g?(this.dispose(),n()):alert(d.UPLOAD_FAILED)},this.add(r),this.add(new R(d.UPLOAD_FILE_OPTIONAL));let o=new N("file","","file","fileInput");o.onChangeDone=c=>{if(l.value()==""){let p=c.replaceAll("\\","/").split("/");l.value(p[p.length-1])}},this.add(o);let a=new _(d.UPLOAD_SEND,"buttonWide");a.onClick=async()=>{let c=S.connections.get(s);if(c==null)return;a.disable(),r.disable();let p=o.htmlElement.files[0];i.endsWith("/")&&(i=i.slice(0,i.length-1));let m=l.value(),g=i+"/"+m,x=await c.putFile(g,p,"");a.enable(),r.enable(),x?(this.dispose(),n()):alert(d.UPLOAD_FAILED)},this.add(a)}update(){}}class Et extends Y{constructor(t,e,n,s){super("popupContent-fullscreen","popupContainer","popupExitBtn"),this.setClass("upload"),this.add(new w("div",d.UPLOAD_TITLE,"popupTitle")),this.add(new R(d.UPLOAD_FILE));let i=new N("file","","file","fileInput");this.add(i);let l=new _(d.UPLOAD_SEND,"buttonWide");l.onClick=async()=>{if(t==null)return;l.disable();let r=i.htmlElement.files[0],o=await t.putFile(e,r,n);l.enable(),o?(this.dispose(),s()):alert(d.UPLOAD_FAILED)},this.add(l)}update(){}}class kt extends w{constructor(){super("div","","filetree");u(this,"searchField");u(this,"entriesView");u(this,"fileTrees",new Map);u(this,"offlineConnections",[]);this.searchField=new N("search",d.FILETREE_SEARCH_PLACEHOLDER,"search","filetreeSearch"),this.searchField.onChange=n=>{this.updateEntriesView()},this.searchField.onChangeDone=n=>{v.update({search:n})},this.add(this.searchField),this.entriesView=new w("div"),this.entriesView.setClass("filetreeEntries"),this.add(this.entriesView);let e=new _(Je,"filetreeSettingsButton");e.onClick=()=>{new ut},this.add(e)}triggerFullUpdate(){this.update({search:this.searchField.value()},!0)}async update(e,n){if(S.connections.size<1){this.fileTrees.clear(),this.entriesView.htmlElement.innerHTML=d.FILETREE_MISSING_CONNECTIONS;return}if(n){this.offlineConnections=[],this.fileTrees.clear();for(let[s,i]of S.connections){console.log("Gathering filetrees for: "+s);let l=await i.walk(".");if(l==null){console.log("Session offline: "+s);let r=localStorage["kb_filetree_cache_"+s];r&&(l=JSON.parse(r)),this.offlineConnections.push(s)}else{let r=JSON.stringify(l);localStorage["kb_filetree_cache_"+s]=r}l!=null&&this.fileTrees.set(s,l)}}(this.searchField.value()!=e.search||n)&&(this.searchField.value(e.search),this.updateEntriesView())}async updateEntriesView(e=50){this.entriesView.htmlElement.innerHTML="",this.showOfflineStatus();let n=this.searchField.value();n==""?await this.renderFiletreeView():await this.renderSearchResults(n,e)}showOfflineStatus(){let e="";for(let n of this.offlineConnections)e==""&&(e=d.FILETREE_OFFLINE),e+=" "+n;if(e!=""){let n=new w("div",e,"filetreeOfflineStatus");this.entriesView.add(n)}}async renderSearchResults(e,n){let s=dt(this.fileTrees,e),i=s.length;s=s.slice(0,n);for(let l of s)this.entriesView.add(new pt(l.filepath,l.sessionName,l.modified!=null?ht(l.modified):"",l.isFolder,this.searchField,this.triggerFullUpdate.bind(this)));if(i>n){let l=new w("div");l.htmlElement.innerText=d.FILETREE_MORE_RESULTS,l.htmlElement.onclick=()=>{this.updateEntriesView(n+25)},this.entriesView.add(l)}}async renderFiletreeView(){this.entriesView.htmlElement.innerHTML="";let e=new w("ul","","filetreeRoot");for(let[n,s]of this.fileTrees)e.add(new se("",n,s));this.entriesView.add(e)}}class Me extends w{constructor(e,n,s,i){super("li","",s?"fileTreeFolder":"fileTreeFile");u(this,"elementSettings");this.path=e,this.name=n,this.isFolder=s,this.hasChildren=i,this.elementSettings=new _(et,"fileTreeElementSettings"),this.elementSettings.setClass("right"),this.elementSettings.onClick=()=>{this.showMenu()},this.add(this.elementSettings);let l=new _("","fileTreeElementTitle");l.onClick=()=>{this.onClick()};let r=s?"filetreeFolderIcon":"filetreeFileIcon";e==""&&(r="filetreeServerIcon"),l.htmlElement.innerHTML+=`<span class="${r}"></span> ${n.replaceAll("_"," ")}`,this.add(l)}onClick(){}showMenu(){let e=new xt(this,this.isFolder,this.path!="",!this.hasChildren&&this.path!="");e.htmlElement.style.display="block",e.htmlElement.style.position="absolute";const n=this.elementSettings.htmlElement.getBoundingClientRect();let s=(n.left+n.right)/2,i=(n.top+n.bottom)/2,l=window.innerWidth,r=window.innerHeight,o=l-s,a=r-i;console.log(e.htmlElement.getBoundingClientRect()),console.log(a,e.htmlElement.clientHeight),console.log(o,e.htmlElement.clientWidth),a<e.htmlElement.clientHeight?e.htmlElement.style.top=`${i-e.htmlElement.clientHeight}px`:e.htmlElement.style.top=`${i}px`,o<e.htmlElement.clientWidth?e.htmlElement.style.left=`${s-e.htmlElement.clientWidth}px`:e.htmlElement.style.left=`${s}px`}getURI(){let e=this.path+"/"+this.name;return e=e.replace("/","").replace("/",":./"),e.includes(":./")||(e=e+":./"),e}async newFile(){new wt(this.getURI(),"",()=>location.reload())}async newFolder(){let e=this.getURI(),n=e.split(":")[0],s=e.split(":")[1],i=S.connections.get(n);if(i==null){alert(d.FILETREE_INVALID_SESSION);return}i.mkdir(s+"/New Folder"),location.reload()}async rename(){let e=this.getURI(),n=e.split(":")[0],s=e.split(":")[1],i=S.connections.get(n);if(i==null){alert(d.FILETREE_INVALID_SESSION);return}let l=new Y;l.htmlElement.style.width="87%",l.htmlElement.style.maxWidth="40em",l.add(new R(d.FILETREE_RENAME_CURRENT_PATH));let r=new N("current_path","","text");r.value(s),r.htmlElement.disabled=!0,l.add(r),l.add(new R(d.FILETREE_RENAME_NEW_PATH));let o=new N("current_path","","text");o.value(s),l.add(o);let a=new _(d.FILETREE_RENAME_CONFIRM,"buttonWide");a.setClass("good"),a.onClick=()=>{i.mv(s,o.value()),location.reload()},l.add(a)}async delete(){let e=this.getURI(),n=e.split(":")[0],s=e.split(":")[1],i=S.connections.get(n);if(i==null){alert(d.FILETREE_INVALID_SESSION);return}let l="";if(!this.isFolder&&await i.md5(s)==null){alert(d.VIEWER_READ_MD5_ERROR);return}let r=new ne("popupContent","popupContainer",d.FILETREE_DELETE_QUESTION+" "+this.path+"/"+this.name,d.FILETREE_DELETE_CANCEL,d.FILETREE_DELETE_CONFIRM);r.onConfirm=()=>{},r.onCancel=()=>{this.isFolder?i.rmdir(s):i.rm(s,l),location.reload()}}}class se extends Me{constructor(e,n,s){super(e,n,!0,Object.keys(s).length>0);u(this,"folderContent");this.children=s,this.folderContent=new w("ul"),this.folderContent.htmlElement.style.display="none",this.add(this.folderContent)}onClick(){if(this.folderContent.htmlElement.style.display==="none"){if(this.folderContent.htmlElement.style.display="",this.folderContent.htmlElement.children.length==0){let e=this.path+"/"+this.name,n=[],s=[],i=[];for(const l in this.children)i.push(l);i=i.sort((l,r)=>l.toLowerCase().localeCompare(r.toLowerCase()));for(const l of i){let r=this.children[l];typeof r!="string"?n.push(new se(e,l,r)):s.push(new bt(e,l))}for(const l of n)this.folderContent.add(l);for(const l of s)this.folderContent.add(l)}}else this.folderContent.htmlElement.style.display="none"}}class bt extends Me{constructor(t,e){super(t,e,!1,!1)}onClick(){v.update({view:this.getURI()})}}class xt extends w{constructor(e,n,s,i){super("div","","filetreeElementMenu");u(this,"background");if(n){let l=new _("New File","filetreeElementMenuButton");l.onClick=()=>{this.close(),e.newFile()},this.add(l);let r=new _("New Folder","filetreeElementMenuButton");r.onClick=()=>{this.close(),e.newFolder()},this.add(r)}if(s){let l=new _("Move","filetreeElementMenuButton");l.onClick=()=>{this.close(),e.rename()},this.add(l)}if(i){let l=new _("Delete","filetreeElementMenuButton");l.onClick=()=>{this.close(),e.delete()},this.add(l)}this.background=new w("div","","popupContainer"),this.background.htmlElement.style.backgroundColor="transparent",this.background.htmlElement.onclick=()=>{this.close()},document.body.appendChild(this.background.htmlElement),document.body.appendChild(this.htmlElement)}close(){document.body.removeChild(this.background.htmlElement),document.body.removeChild(this.htmlElement)}}function ie(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let D=ie();function ze(h){D=h}const U={exec:()=>null};function b(h,t=""){let e=typeof h=="string"?h:h.source;const n={replace:(s,i)=>{let l=typeof i=="string"?i:i.source;return l=l.replace(y.caret,"$1"),e=e.replace(s,l),n},getRegex:()=>new RegExp(e,t)};return n}const y={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:h=>new RegExp(`^( {0,3}${h})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}#`),htmlBeginRegex:h=>new RegExp(`^ {0,${Math.min(3,h-1)}}<(?:[a-z].*>|!--)`,"i")},_t=/^(?:[ \t]*(?:\n|$))+/,yt=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,St=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,H=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Tt=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,$e=/(?:[*+-]|\d{1,9}[.)])/,Ue=b(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,$e).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),le=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ct=/^[^\n]+/,re=/(?!\s*\])(?:\\.|[^\[\]\\])+/,It=b(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",re).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Lt=b(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,$e).getRegex(),Z="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",oe=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Rt=b("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",oe).replace("tag",Z).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Be=b(le).replace("hr",H).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Z).getRegex(),Nt=b(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Be).getRegex(),ae={blockquote:Nt,code:yt,def:It,fences:St,heading:Tt,hr:H,html:Rt,lheading:Ue,list:Lt,newline:_t,paragraph:Be,table:U,text:Ct},Ce=b("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",H).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Z).getRegex(),vt={...ae,table:Ce,paragraph:b(le).replace("hr",H).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ce).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Z).getRegex()},Ot={...ae,html:b(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",oe).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:U,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:b(le).replace("hr",H).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ue).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},He=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,At=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Ve=/^( {2,}|\\)\n(?!\s*$)/,Ft=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,X=/[\p{P}\p{S}]/u,ce=/[\s\p{P}\p{S}]/u,We=/[^\s\p{P}\p{S}]/u,Dt=b(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ce).getRegex(),Pt=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Mt=b(/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,"u").replace(/punct/g,X).getRegex(),zt=b("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)","gu").replace(/notPunctSpace/g,We).replace(/punctSpace/g,ce).replace(/punct/g,X).getRegex(),$t=b("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,We).replace(/punctSpace/g,ce).replace(/punct/g,X).getRegex(),Ut=b(/\\(punct)/,"gu").replace(/punct/g,X).getRegex(),Bt=b(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ht=b(oe).replace("(?:-->|$)","-->").getRegex(),Vt=b("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ht).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),W=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Wt=b(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",W).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Ge=b(/^!?\[(label)\]\[(ref)\]/).replace("label",W).replace("ref",re).getRegex(),qe=b(/^!?\[(ref)\](?:\[\])?/).replace("ref",re).getRegex(),Gt=b("reflink|nolink(?!\\()","g").replace("reflink",Ge).replace("nolink",qe).getRegex(),he={_backpedal:U,anyPunctuation:Ut,autolink:Bt,blockSkip:Pt,br:Ve,code:At,del:U,emStrongLDelim:Mt,emStrongRDelimAst:zt,emStrongRDelimUnd:$t,escape:He,link:Wt,nolink:qe,punctuation:Dt,reflink:Ge,reflinkSearch:Gt,tag:Vt,text:Ft,url:U},qt={...he,link:b(/^!?\[(label)\]\((.*?)\)/).replace("label",W).getRegex(),reflink:b(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",W).getRegex()},te={...he,escape:b(He).replace("])","~|])").getRegex(),url:b(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},jt={...te,br:b(Ve).replace("{2,}","*").getRegex(),text:b(te.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},V={normal:ae,gfm:vt,pedantic:Ot},z={normal:he,gfm:te,breaks:jt,pedantic:qt},Yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ie=h=>Yt[h];function L(h,t){if(t){if(y.escapeTest.test(h))return h.replace(y.escapeReplace,Ie)}else if(y.escapeTestNoEncode.test(h))return h.replace(y.escapeReplaceNoEncode,Ie);return h}function Le(h){try{h=encodeURI(h).replace(y.percentDecode,"%")}catch{return null}return h}function Re(h,t){var i;const e=h.replace(y.findPipe,(l,r,o)=>{let a=!1,c=r;for(;--c>=0&&o[c]==="\\";)a=!a;return a?"|":" |"}),n=e.split(y.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!((i=n.at(-1))!=null&&i.trim())&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(y.slashPipe,"|");return n}function $(h,t,e){const n=h.length;if(n===0)return"";let s=0;for(;s<n;){const i=h.charAt(n-s-1);if(i===t&&!e)s++;else if(i!==t&&e)s++;else break}return h.slice(0,n-s)}function Zt(h,t){if(h.indexOf(t[1])===-1)return-1;let e=0;for(let n=0;n<h.length;n++)if(h[n]==="\\")n++;else if(h[n]===t[0])e++;else if(h[n]===t[1]&&(e--,e<0))return n;return-1}function Ne(h,t,e,n,s){const i=t.href,l=t.title||null,r=h[1].replace(s.other.outputLinkReplace,"$1");if(h[0].charAt(0)!=="!"){n.state.inLink=!0;const o={type:"link",raw:e,href:i,title:l,text:r,tokens:n.inlineTokens(r)};return n.state.inLink=!1,o}return{type:"image",raw:e,href:i,title:l,text:r}}function Xt(h,t,e){const n=h.match(e.other.indentCodeCompensation);if(n===null)return t;const s=n[1];return t.split(`
`).map(i=>{const l=i.match(e.other.beginningSpace);if(l===null)return i;const[r]=l;return r.length>=s.length?i.slice(s.length):i}).join(`
`)}class G{constructor(t){u(this,"options");u(this,"rules");u(this,"lexer");this.options=t||D}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:$(n,`
`)}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const n=e[0],s=Xt(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:s}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){const s=$(n,"#");(this.options.pedantic||!s||this.rules.other.endingSpaceChar.test(s))&&(n=s.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:$(e[0],`
`)}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let n=$(e[0],`
`).split(`
`),s="",i="";const l=[];for(;n.length>0;){let r=!1;const o=[];let a;for(a=0;a<n.length;a++)if(this.rules.other.blockquoteStart.test(n[a]))o.push(n[a]),r=!0;else if(!r)o.push(n[a]);else break;n=n.slice(a);const c=o.join(`
`),p=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");s=s?`${s}
${c}`:c,i=i?`${i}
${p}`:p;const m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,l,!0),this.lexer.state.top=m,n.length===0)break;const g=l.at(-1);if((g==null?void 0:g.type)==="code")break;if((g==null?void 0:g.type)==="blockquote"){const x=g,E=x.raw+`
`+n.join(`
`),T=this.blockquote(E);l[l.length-1]=T,s=s.substring(0,s.length-x.raw.length)+T.raw,i=i.substring(0,i.length-x.text.length)+T.text;break}else if((g==null?void 0:g.type)==="list"){const x=g,E=x.raw+`
`+n.join(`
`),T=this.list(E);l[l.length-1]=T,s=s.substring(0,s.length-g.raw.length)+T.raw,i=i.substring(0,i.length-x.raw.length)+T.raw,n=E.substring(l.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:s,tokens:l,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim();const s=n.length>1,i={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const l=this.rules.other.listItemRegex(n);let r=!1;for(;t;){let a=!1,c="",p="";if(!(e=l.exec(t))||this.rules.block.hr.test(t))break;c=e[0],t=t.substring(c.length);let m=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,Q=>" ".repeat(3*Q.length)),g=t.split(`
`,1)[0],x=!m.trim(),E=0;if(this.options.pedantic?(E=2,p=m.trimStart()):x?E=e[1].length+1:(E=e[2].search(this.rules.other.nonSpaceChar),E=E>4?1:E,p=m.slice(E),E+=e[1].length),x&&this.rules.other.blankLine.test(g)&&(c+=g+`
`,t=t.substring(g.length+1),a=!0),!a){const Q=this.rules.other.nextBulletRegex(E),fe=this.rules.other.hrRegex(E),me=this.rules.other.fencesBeginRegex(E),ge=this.rules.other.headingBeginRegex(E),je=this.rules.other.htmlBeginRegex(E);for(;t;){const K=t.split(`
`,1)[0];let M;if(g=K,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),M=g):M=g.replace(this.rules.other.tabCharGlobal,"    "),me.test(g)||ge.test(g)||je.test(g)||Q.test(g)||fe.test(g))break;if(M.search(this.rules.other.nonSpaceChar)>=E||!g.trim())p+=`
`+M.slice(E);else{if(x||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||me.test(m)||ge.test(m)||fe.test(m))break;p+=`
`+g}!x&&!g.trim()&&(x=!0),c+=K+`
`,t=t.substring(K.length+1),m=M.slice(E)}}i.loose||(r?i.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(r=!0));let T=null,de;this.options.gfm&&(T=this.rules.other.listIsTask.exec(p),T&&(de=T[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:c,task:!!T,checked:de,loose:!1,text:p,tokens:[]}),i.raw+=c}const o=i.items.at(-1);if(o)o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let a=0;a<i.items.length;a++)if(this.lexer.state.top=!1,i.items[a].tokens=this.lexer.blockTokens(i.items[a].text,[]),!i.loose){const c=i.items[a].tokens.filter(m=>m.type==="space"),p=c.length>0&&c.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=p}if(i.loose)for(let a=0;a<i.items.length;a++)i.items[a].loose=!0;return i}}html(t){const e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){const e=this.rules.block.def.exec(t);if(e){const n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),s=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:s,title:i}}}table(t){var r;const e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;const n=Re(e[1]),s=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=(r=e[3])!=null&&r.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],l={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const o of s)this.rules.other.tableAlignRight.test(o)?l.align.push("right"):this.rules.other.tableAlignCenter.test(o)?l.align.push("center"):this.rules.other.tableAlignLeft.test(o)?l.align.push("left"):l.align.push(null);for(let o=0;o<n.length;o++)l.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:l.align[o]});for(const o of i)l.rows.push(Re(o,l.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:l.align[c]})));return l}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const l=$(n.slice(0,-1),"\\");if((n.length-l.length)%2===0)return}else{const l=Zt(e[2],"()");if(l>-1){const o=(e[0].indexOf("!")===0?5:4)+e[1].length+l;e[2]=e[2].substring(0,l),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let s=e[2],i="";if(this.options.pedantic){const l=this.rules.other.pedanticHrefTitle.exec(s);l&&(s=l[1],i=l[3])}else i=e[3]?e[3].slice(1,-1):"";return s=s.trim(),this.rules.other.startAngleBracket.test(s)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?s=s.slice(1):s=s.slice(1,-1)),Ne(e,{href:s&&s.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const s=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[s.toLowerCase()];if(!i){const l=n[0].charAt(0);return{type:"text",raw:l,text:l}}return Ne(n,i,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let s=this.rules.inline.emStrongLDelim.exec(t);if(!s||s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const l=[...s[0]].length-1;let r,o,a=l,c=0;const p=s[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*t.length+l);(s=p.exec(e))!=null;){if(r=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!r)continue;if(o=[...r].length,s[3]||s[4]){a+=o;continue}else if((s[5]||s[6])&&l%3&&!((l+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);const m=[...s[0]][0].length,g=t.slice(0,l+s.index+m+o);if(Math.min(l,o)%2){const E=g.slice(1,-1);return{type:"em",raw:g,text:E,tokens:this.lexer.inlineTokens(E)}}const x=g.slice(2,-2);return{type:"strong",raw:g,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," ");const s=this.rules.other.nonSpaceChar.test(n),i=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return s&&i&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let n,s;return e[2]==="@"?(n=e[1],s="mailto:"+n):(n=e[1],s=n),{type:"link",raw:e[0],text:n,href:s,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let e;if(e=this.rules.inline.url.exec(t)){let s,i;if(e[2]==="@")s=e[0],i="mailto:"+s;else{let l;do l=e[0],e[0]=((n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])??"";while(l!==e[0]);s=e[0],e[1]==="www."?i="http://"+e[0]:i=e[0]}return{type:"link",raw:e[0],text:s,href:i,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}}class C{constructor(t){u(this,"tokens");u(this,"options");u(this,"state");u(this,"tokenizer");u(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||D,this.options.tokenizer=this.options.tokenizer||new G,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:y,block:V.normal,inline:z.normal};this.options.pedantic?(e.block=V.pedantic,e.inline=z.pedantic):this.options.gfm&&(e.block=V.gfm,this.options.breaks?e.inline=z.breaks:e.inline=z.gfm),this.tokenizer.rules=e}static get rules(){return{block:V,inline:z}}static lex(t,e){return new C(e).lex(t)}static lexInline(t,e){return new C(e).inlineTokens(t)}lex(t){t=t.replace(y.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const n=this.inlineQueue[e];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],n=!1){var s,i,l;for(this.options.pedantic&&(t=t.replace(y.tabCharGlobal,"    ").replace(y.spaceLine,""));t;){let r;if((i=(s=this.options.extensions)==null?void 0:s.block)!=null&&i.some(a=>(r=a.call({lexer:this},t,e))?(t=t.substring(r.raw.length),e.push(r),!0):!1))continue;if(r=this.tokenizer.space(t)){t=t.substring(r.raw.length);const a=e.at(-1);r.raw.length===1&&a!==void 0?a.raw+=`
`:e.push(r);continue}if(r=this.tokenizer.code(t)){t=t.substring(r.raw.length);const a=e.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.at(-1).src=a.text):e.push(r);continue}if(r=this.tokenizer.fences(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.heading(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.hr(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.blockquote(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.list(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.html(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.def(t)){t=t.substring(r.raw.length);const a=e.at(-1);(a==null?void 0:a.type)==="paragraph"||(a==null?void 0:a.type)==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.lheading(t)){t=t.substring(r.raw.length),e.push(r);continue}let o=t;if((l=this.options.extensions)!=null&&l.startBlock){let a=1/0;const c=t.slice(1);let p;this.options.extensions.startBlock.forEach(m=>{p=m.call({lexer:this},c),typeof p=="number"&&p>=0&&(a=Math.min(a,p))}),a<1/0&&a>=0&&(o=t.substring(0,a+1))}if(this.state.top&&(r=this.tokenizer.paragraph(o))){const a=e.at(-1);n&&(a==null?void 0:a.type)==="paragraph"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):e.push(r),n=o.length!==t.length,t=t.substring(r.raw.length);continue}if(r=this.tokenizer.text(t)){t=t.substring(r.raw.length);const a=e.at(-1);(a==null?void 0:a.type)==="text"?(a.raw+=`
`+r.raw,a.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):e.push(r);continue}if(t){const a="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){var r,o,a;let n=t,s=null;if(this.tokens.links){const c=Object.keys(this.tokens.links);if(c.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)c.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i=!1,l="";for(;t;){i||(l=""),i=!1;let c;if((o=(r=this.options.extensions)==null?void 0:r.inline)!=null&&o.some(m=>(c=m.call({lexer:this},t,e))?(t=t.substring(c.raw.length),e.push(c),!0):!1))continue;if(c=this.tokenizer.escape(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.tag(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.link(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(c.raw.length);const m=e.at(-1);c.type==="text"&&(m==null?void 0:m.type)==="text"?(m.raw+=c.raw,m.text+=c.text):e.push(c);continue}if(c=this.tokenizer.emStrong(t,n,l)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.codespan(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.br(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.del(t)){t=t.substring(c.raw.length),e.push(c);continue}if(c=this.tokenizer.autolink(t)){t=t.substring(c.raw.length),e.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(t))){t=t.substring(c.raw.length),e.push(c);continue}let p=t;if((a=this.options.extensions)!=null&&a.startInline){let m=1/0;const g=t.slice(1);let x;this.options.extensions.startInline.forEach(E=>{x=E.call({lexer:this},g),typeof x=="number"&&x>=0&&(m=Math.min(m,x))}),m<1/0&&m>=0&&(p=t.substring(0,m+1))}if(c=this.tokenizer.inlineText(p)){t=t.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(l=c.raw.slice(-1)),i=!0;const m=e.at(-1);(m==null?void 0:m.type)==="text"?(m.raw+=c.raw,m.text+=c.text):e.push(c);continue}if(t){const m="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(m);break}else throw new Error(m)}}return e}}class q{constructor(t){u(this,"options");u(this,"parser");this.options=t||D}space(t){return""}code({text:t,lang:e,escaped:n}){var l;const s=(l=(e||"").match(y.notSpaceStart))==null?void 0:l[0],i=t.replace(y.endingNewline,"")+`
`;return s?'<pre><code class="language-'+L(s)+'">'+(n?i:L(i,!0))+`</code></pre>
`:"<pre><code>"+(n?i:L(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){const e=t.ordered,n=t.start;let s="";for(let r=0;r<t.items.length;r++){const o=t.items[r];s+=this.listitem(o)}const i=e?"ol":"ul",l=e&&n!==1?' start="'+n+'"':"";return"<"+i+l+`>
`+s+"</"+i+`>
`}listitem(t){var n;let e="";if(t.task){const s=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=s+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=s+" "+L(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):e+=s+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let i=0;i<t.header.length;i++)n+=this.tablecell(t.header[i]);e+=this.tablerow({text:n});let s="";for(let i=0;i<t.rows.length;i++){const l=t.rows[i];n="";for(let r=0;r<l.length;r++)n+=this.tablecell(l[r]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+s+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){const e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${L(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){const s=this.parser.parseInline(n),i=Le(t);if(i===null)return s;t=i;let l='<a href="'+t+'"';return e&&(l+=' title="'+L(e)+'"'),l+=">"+s+"</a>",l}image({href:t,title:e,text:n}){const s=Le(t);if(s===null)return L(n);t=s;let i=`<img src="${t}" alt="${n}"`;return e&&(i+=` title="${L(e)}"`),i+=">",i}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:L(t.text)}}class ue{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}}class I{constructor(t){u(this,"options");u(this,"renderer");u(this,"textRenderer");this.options=t||D,this.options.renderer=this.options.renderer||new q,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ue}static parse(t,e){return new I(e).parse(t)}static parseInline(t,e){return new I(e).parseInline(t)}parse(t,e=!0){var s,i;let n="";for(let l=0;l<t.length;l++){const r=t[l];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[r.type]){const a=r,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(a.type)){n+=c||"";continue}}const o=r;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;l+1<t.length&&t[l+1].type==="text";)a=t[++l],c+=`
`+this.renderer.text(a);e?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,e=this.renderer){var s,i;let n="";for(let l=0;l<t.length;l++){const r=t[l];if((i=(s=this.options.extensions)==null?void 0:s.renderers)!=null&&i[r.type]){const a=this.options.extensions.renderers[r.type].call({parser:this},r);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){n+=a||"";continue}}const o=r;switch(o.type){case"escape":{n+=e.text(o);break}case"html":{n+=e.html(o);break}case"link":{n+=e.link(o);break}case"image":{n+=e.image(o);break}case"strong":{n+=e.strong(o);break}case"em":{n+=e.em(o);break}case"codespan":{n+=e.codespan(o);break}case"br":{n+=e.br(o);break}case"del":{n+=e.del(o);break}case"text":{n+=e.text(o);break}default:{const a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}}class B{constructor(t){u(this,"options");u(this,"block");this.options=t||D}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?C.lex:C.lexInline}provideParser(){return this.block?I.parse:I.parseInline}}u(B,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));class Qt{constructor(...t){u(this,"defaults",ie());u(this,"options",this.setOptions);u(this,"parse",this.parseMarkdown(!0));u(this,"parseInline",this.parseMarkdown(!1));u(this,"Parser",I);u(this,"Renderer",q);u(this,"TextRenderer",ue);u(this,"Lexer",C);u(this,"Tokenizer",G);u(this,"Hooks",B);this.use(...t)}walkTokens(t,e){var s,i;let n=[];for(const l of t)switch(n=n.concat(e.call(this,l)),l.type){case"table":{const r=l;for(const o of r.header)n=n.concat(this.walkTokens(o.tokens,e));for(const o of r.rows)for(const a of o)n=n.concat(this.walkTokens(a.tokens,e));break}case"list":{const r=l;n=n.concat(this.walkTokens(r.items,e));break}default:{const r=l;(i=(s=this.defaults.extensions)==null?void 0:s.childTokens)!=null&&i[r.type]?this.defaults.extensions.childTokens[r.type].forEach(o=>{const a=r[o].flat(1/0);n=n.concat(this.walkTokens(a,e))}):r.tokens&&(n=n.concat(this.walkTokens(r.tokens,e)))}}return n}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{const s={...n};if(s.async=this.defaults.async||s.async||!1,n.extensions&&(n.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){const l=e.renderers[i.name];l?e.renderers[i.name]=function(...r){let o=i.renderer.apply(this,r);return o===!1&&(o=l.apply(this,r)),o}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const l=e[i.level];l?l.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),s.extensions=e),n.renderer){const i=this.defaults.renderer||new q(this.defaults);for(const l in n.renderer){if(!(l in i))throw new Error(`renderer '${l}' does not exist`);if(["options","parser"].includes(l))continue;const r=l,o=n.renderer[r],a=i[r];i[r]=(...c)=>{let p=o.apply(i,c);return p===!1&&(p=a.apply(i,c)),p||""}}s.renderer=i}if(n.tokenizer){const i=this.defaults.tokenizer||new G(this.defaults);for(const l in n.tokenizer){if(!(l in i))throw new Error(`tokenizer '${l}' does not exist`);if(["options","rules","lexer"].includes(l))continue;const r=l,o=n.tokenizer[r],a=i[r];i[r]=(...c)=>{let p=o.apply(i,c);return p===!1&&(p=a.apply(i,c)),p}}s.tokenizer=i}if(n.hooks){const i=this.defaults.hooks||new B;for(const l in n.hooks){if(!(l in i))throw new Error(`hook '${l}' does not exist`);if(["options","block"].includes(l))continue;const r=l,o=n.hooks[r],a=i[r];B.passThroughHooks.has(l)?i[r]=c=>{if(this.defaults.async)return Promise.resolve(o.call(i,c)).then(m=>a.call(i,m));const p=o.call(i,c);return a.call(i,p)}:i[r]=(...c)=>{let p=o.apply(i,c);return p===!1&&(p=a.apply(i,c)),p}}s.hooks=i}if(n.walkTokens){const i=this.defaults.walkTokens,l=n.walkTokens;s.walkTokens=function(r){let o=[];return o.push(l.call(this,r)),i&&(o=o.concat(i.call(this,r))),o}}this.defaults={...this.defaults,...s}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return C.lex(t,e??this.defaults)}parser(t,e){return I.parse(t,e??this.defaults)}parseMarkdown(t){return(n,s)=>{const i={...s},l={...this.defaults,...i},r=this.onError(!!l.silent,!!l.async);if(this.defaults.async===!0&&i.async===!1)return r(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return r(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return r(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));l.hooks&&(l.hooks.options=l,l.hooks.block=t);const o=l.hooks?l.hooks.provideLexer():t?C.lex:C.lexInline,a=l.hooks?l.hooks.provideParser():t?I.parse:I.parseInline;if(l.async)return Promise.resolve(l.hooks?l.hooks.preprocess(n):n).then(c=>o(c,l)).then(c=>l.hooks?l.hooks.processAllTokens(c):c).then(c=>l.walkTokens?Promise.all(this.walkTokens(c,l.walkTokens)).then(()=>c):c).then(c=>a(c,l)).then(c=>l.hooks?l.hooks.postprocess(c):c).catch(r);try{l.hooks&&(n=l.hooks.preprocess(n));let c=o(n,l);l.hooks&&(c=l.hooks.processAllTokens(c)),l.walkTokens&&this.walkTokens(c,l.walkTokens);let p=a(c,l);return l.hooks&&(p=l.hooks.postprocess(p)),p}catch(c){return r(c)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const s="<p>An error occurred:</p><pre>"+L(n.message+"",!0)+"</pre>";return e?Promise.resolve(s):s}if(e)return Promise.reject(n);throw n}}}const F=new Qt;function k(h,t){return F.parse(h,t)}k.options=k.setOptions=function(h){return F.setOptions(h),k.defaults=F.defaults,ze(k.defaults),k};k.getDefaults=ie;k.defaults=D;k.use=function(...h){return F.use(...h),k.defaults=F.defaults,ze(k.defaults),k};k.walkTokens=function(h,t){return F.walkTokens(h,t)};k.parseInline=F.parseInline;k.Parser=I;k.parser=I.parse;k.Renderer=q;k.TextRenderer=ue;k.Lexer=C;k.lexer=C.lex;k.Tokenizer=G;k.Hooks=B;k.parse=k;k.options;k.setOptions;k.use;k.walkTokens;k.parseInline;const Kt=k;I.parse;C.lex;const Jt=new RegExp(/\n\s*(```)/);class en{constructor(t,e=null,n=!0){u(this,"allowEdit",!0);u(this,"savedText","");this.root=t,this.onSave=e,e==null&&(this.allowEdit=!1),n&&e!=null&&document.addEventListener("keydown",s=>{s.ctrlKey&&s.key==="s"&&(s.preventDefault(),this.save())})}async load(t,e=!1){if(!this.isSaved()&&!e)return!1;this.savedText=t,this.root.innerHTML="";let n=this.render(t);for(let s of n)this.root.appendChild(await s);return!0}save(){let t=this.getText();this.onSave==null?this.isSaved()||alert("ERROR: This should not happen! Documents should not be editable if onSave is null."):this.onSave(t).then(()=>{t==this.getText()&&(this.savedText=t)})}getText(){let t="";for(let e of this.root.children)t+=e.getAttribute("data-text")+`

`;for(;t.endsWith(`

`);)t=t.slice(0,t.length-1);return t}isSaved(){return this.savedText==this.getText()}pluginCreateChunk(t){return t}onDirty(){}pluginOpenEditor(t,e){return null}render(t){let e=t.split(`

`);const n=[];for(let s=0;s<e.length;s++){let i=e[s];if(Jt.test(i))for(;s+1<e.length&&(s++,i+=`

`+e[s],!e[s].includes("```")););n.push(this.createChunk(i))}return n}async createChunk(t){let e=document.createElement("div");return e.classList.add("chunk"),t=this.pluginCreateChunk(t),e.innerHTML=await Kt(t),e.innerHTML==""&&(e.innerHTML="<p><i>"+d.MD_EMPTY_CELL+"</i></p>"),e.onclick=n=>{this.allowEdit&&this.openEditor(e)},e.setAttribute("data-text",t),e}openEditor(t){let e=t.getAttribute("data-text"),n=this;async function s(o){if(o!=""){let a=n.render(o);for(let c of a)n.root.insertBefore(await c,l)}n.root.removeChild(l),n.getText()==""&&n.root.append(await n.createChunk("")),o!=e&&n.onDirty()}let i=this.pluginOpenEditor(e,s);if(i!=null){i.setAttribute("data-text",e),this.root.replaceChild(i,t);return}let l=document.createElement("textarea");l.setAttribute("data-text",e),l.classList.add("editorChunk"),l.placeholder="Add markdown text here!",l.value=e,l.style.height=e.split(`
`).length*1.2+.2+"em",window.setTimeout(()=>{l.style.height="0px",l.style.height=l.scrollHeight+"px"},10),l.setAttribute("data-text",e),l.addEventListener("paste",async o=>{var c,p,m;const a=typeof((c=navigator==null?void 0:navigator.clipboard)==null?void 0:c.read)=="function"?await navigator.clipboard.read():o.clipboardData.files;for(const g of a)if(g instanceof File&&((p=g.type)!=null&&p.startsWith("image/")))r(g),o.preventDefault();else if(g instanceof ClipboardItem){const x=(m=g.types)==null?void 0:m.filter(E=>E.startsWith("image/"));for(const E of x)r(await g.getType(E)),o.preventDefault()}});const r=o=>{var a=new FileReader;a.readAsDataURL(o),a.onloadend=function(){var c=a.result;let p="![pasted image]("+c+")";if(l.selectionStart||l.selectionStart==0){var m=l.selectionStart,g=l.selectionEnd;l.value=l.value.substring(0,m)+p+l.value.substring(g,l.value.length)}else l.value+=p}};this.root.replaceChild(l,t),l.focus(),l.setSelectionRange(e.length,e.length),l.onkeyup=()=>{l.setAttribute("data-text",l.value),l.style.height="0px",l.style.height=l.scrollHeight+"px"},l.onblur=o=>{s(l.value)},l.addEventListener("keydown",o=>{(o.ctrlKey||o.shiftKey)&&o.key==="Enter"&&l.blur()}),l.oninput=()=>{l.setAttribute("data-text",l.value.replaceAll(`\r
`,`
`)),n.onDirty()}}}let tn='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M288 109.3L288 352c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-242.7-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352l128 0c0 35.3 28.7 64 64 64s64-28.7 64-64l128 0c35.3 0 64 28.7 64 64l0 32c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64l0-32c0-35.3 28.7-64 64-64zM432 456a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"/></svg>',nn='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"/></svg>',sn='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l82.7 0L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3l0 82.7c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160c0-17.7-14.3-32-32-32L320 0zM80 32C35.8 32 0 67.8 0 112L0 432c0 44.2 35.8 80 80 80l320 0c44.2 0 80-35.8 80-80l0-112c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 112c0 8.8-7.2 16-16 16L80 448c-8.8 0-16-7.2-16-16l0-320c0-8.8 7.2-16 16-16l112 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 32z"/></svg>',ve='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z"/></svg>',ln='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M448 80c8.8 0 16 7.2 16 16V415.8l-5-6.5-136-176c-4.5-5.9-11.6-9.3-19-9.3s-14.4 3.4-19 9.3L202 340.7l-30.5-42.7C167 291.7 159.8 288 152 288s-15 3.7-19.5 10.1l-80 112L48 416.3l0-.3V96c0-8.8 7.2-16 16-16H448zM64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm80 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"/></svg>',Oe='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M441 58.9L453.1 71c9.4 9.4 9.4 24.6 0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9 0zM209.8 256.2L344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1l-58.5 16.7 16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25L175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 100c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l100-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7 0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4 0 152V424c0 48.6 39.4 88 88 88H360c48.6 0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1 0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H200c13.3 0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>';class rn extends w{constructor(t="navbar"){super("div","",t)}}class O extends _{constructor(t,e="navbar-button"){super(t,e)}}class on extends w{constructor(t,e="navbar-header"){super("div",t,e)}}const an=["txt","csv","json","yaml","py","ts","js","rs","c","h","hpp","cpp","sh","bat"];class pe{constructor(t,e,n,s,i){this.instance=t,this.filepath=e,this.filename=n,this.md5=s,this.ext=i}static async get(t){let e=t.split(":")[0],n=t.split(":")[1],s=n.split("/")[n.split("/").length-1],i=s.split("."),l=i[i.length-1].toLowerCase(),r=S.connections.get(e);if(r==null)return null;let o=await r.md5(n);return o==null?null:new pe(r,n,s,o,l)}}class cn extends w{constructor(){super("div","","editPage");u(this,"openDocument","");u(this,"isDirty",!1);u(this,"saveCallback",null);document.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),this.saveCallback!=null&&this.saveCallback())})}async update(e,n){if(e.view==this.openDocument)return;if(this.isDirty){alert(d.VIEWER_UNSAVED_CHANGES);return}if(this.openDocument=e.view,this.parent.parent.setPreferedView("master"),this.htmlElement.innerHTML="",this.saveCallback=null,e.view=="")return;let s=await pe.get(e.view);if(s==null){alert(d.VIEWER_READ_FILE_ERROR);return}this.parent.parent.setPreferedView("detail"),["png","jpg","jpeg","tiff","tif"].includes(s.ext)?await this.handleImageFile(s):["md"].includes(s.ext)?await this.handleMDFile(s):an.includes(s.ext)?await this.handleTextFile(s):["pdf"].includes(s.ext)?await this.handlePDFFile(s):await this.handleUnknownFile(s)}async handleImageFile(e){this.createNavbar(e);let n=new w("div","","editImageBackground"),s=new w("img","","editImageView");n.add(s),this.add(n);let i=["tiff","tif"].includes(e.ext)?-1:0;s.htmlElement.src=e.instance.readURL(e.filepath,i),s.htmlElement.onload=()=>{let l=s.htmlElement.width,r=s.htmlElement.height,o=n.htmlElement.clientWidth,a=n.htmlElement.clientHeight,c=l/o,p=r/a,m=c>p?c:p;s.htmlElement.width=l/m,s.htmlElement.height=r/m}}async handleMDFile(e){let n=new O(ve);n.hide(),this.createNavbar(e,[n],[],()=>r.isSaved());let s=new w("div","","editTextOutput"),i=new w("div","","mdOutput");s.add(i),this.add(s);let l=await e.instance.readTxt(e.filepath);if(l==null||e.md5==null){alert(d.VIEWER_READ_FILE_ERROR);return}let r=new en(i.htmlElement,async o=>this.onSave(e,o,n,()=>r.getText()),!1);r.load(l),r.onDirty=()=>{r.isSaved()?(n.hide(),this.isDirty=!1):(n.show(),this.isDirty=!0)},n.onClick=async()=>{r.save()},this.saveCallback=n.onClick}async handleTextFile(e){let n=!1,s=new O(ve);s.hide();let i=new O(Oe);this.createNavbar(e,[s],[i],()=>o.htmlElement.value.replaceAll(`\r
`,`
`)==l);let l=await e.instance.readTxt(e.filepath);if(l==null||e.md5==null){alert(d.VIEWER_READ_FILE_ERROR);return}l=l.replaceAll(`\r
`,`
`);let r=new w("div","","editTextOutput");r.htmlElement.innerHTML=l.replaceAll(`
`,"<BR>"),r.htmlElement.style.paddingTop="1em",this.add(r);let o=new w("textarea","","editTextOutputEdit");o.htmlElement.value=l,o.htmlElement.style.resize="none",o.hide(),o.htmlElement.oninput=()=>{o.htmlElement.value.replaceAll(`\r
`,`
`)==l?(s.hide(),this.isDirty=!1):(s.show(),this.isDirty=!0)},this.add(o),s.onClick=async()=>{let a=o.htmlElement.value.replaceAll(`\r
`,`
`);this.onSave(e,a,s,()=>o.htmlElement.value.replaceAll(`\r
`,`
`)),l=a},this.saveCallback=s.onClick,i.onClick=()=>{n=!n,n?(i.htmlElement.innerHTML=ln,r.hide(),o.show()):(i.htmlElement.innerHTML=Oe,r.htmlElement.innerHTML=o.htmlElement.value.replaceAll(`
`,"<BR>"),r.show(),o.hide())}}async handlePDFFile(e){this.createNavbar(e);let n=new w("iframe","","editIFrame");n.htmlElement.name="editIFrame",n.htmlElement.src=e.instance.readURL(e.filepath),this.add(n)}async handleUnknownFile(e){this.createNavbar(e);let n=new w("div","","centerChildren"),s=new _(d.VIEWER_LOAD_HERE_FILE,"buttonLarge");s.setClass("good"),s.onClick=()=>{let i=new w("iframe","","editIFrame");i.htmlElement.name="editIFrame",i.htmlElement.src=e.instance.readURL(e.filepath),this.remove(n),this.add(i)},n.add(s),this.add(n)}async onSave(e,n,s,i){if(e.instance==null)return!1;if(await e.instance.putTxt(e.filepath,n,e.md5)){i()==n&&(s.hide(),this.isDirty=!1);let r=await e.instance.md5(e.filepath);if(r==null)return alert(d.VIEWER_READ_MD5_ERROR),!1;e.md5=r}else return alert(d.VIEWER_SAVE_FILE_ERROR),!1;return!0}createNavbar(e,n=[],s=[],i=()=>!0){let l=new rn,r=new O(Ae);r.setClass("left"),r.onClick=()=>{if(i())v.update({view:""});else{let p=new ne("popupContent","popupContainer",d.VIEWER_EXIT_WITHOUT_SAVE_QUESTION,d.VIEWER_EXIT_WITHOUT_SAVE_CONTINUE_EDITING,d.VIEWER_EXIT_WITHOUT_SAVE_EXIT);p.onConfirm=()=>{},p.onCancel=()=>{this.isDirty=!1,v.update({view:""})}}},l.add(r),n.forEach(p=>{p.setClass("left"),l.add(p)}),l.add(new on(e.filename));let o=e.instance.readURL(e.filepath);if(o.includes("localhost")||o.includes("127.0.0.1")){let p=new O(sn);p.setClass("right"),p.onClick=()=>{e.instance.open(e.filepath)},l.add(p)}let a=new O(nn);a.setClass("right"),a.htmlElement.href=o,a.htmlElement.download=e.filename,l.add(a);let c=new O(tn);c.setClass("right"),c.onClick=()=>{new Et(e.instance,e.filepath,e.md5,()=>{location.reload()})},l.add(c),s.forEach(p=>{p.setClass("right"),l.add(p)}),this.add(l)}hide(){super.hide()}}class hn extends w{constructor(){super("div","Not implemented yet!","ai-chat")}}async function un(){Xe(),tt("kb"),document.getElementsByTagName("title")[0].innerHTML=d.APPNAME,it(),new v("main&search=&view=",{main:new ee(new kt,new cn,new hn)})}un();
