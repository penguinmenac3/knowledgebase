var H=Object.defineProperty;var G=(a,s,e)=>s in a?H(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e;var l=(a,s,e)=>(G(a,typeof s!="symbol"?s+"":s,e),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class E{constructor(s,e){l(this,"currentPage","");var t;this.defaultPage=s,this.pages=e,location.hash.slice(1)==""&&(location.hash="#"+s),window.onhashchange=n=>{this.onOpen()};for(const n in e)(t=document.getElementById("app"))==null||t.appendChild(e[n].htmlElement),e[n].hide();this.onOpen()}onOpen(){var o,u,m;let s={},e=this.defaultPage,n=location.hash.slice(1).split("&");n.length>0&&(e=n[0],n=n.splice(1));for(const p of n){let f=p.split("="),S=decodeURIComponent(f[0]),d=decodeURIComponent(f[1]);s[S]=d}let i=this.currentPage!=e;i&&(console.log("Hide page: "+this.currentPage),(o=this.pages[this.currentPage])==null||o.hide(),this.currentPage=e,console.log("Show page: "+e),(u=this.pages[this.currentPage])==null||u.show()),console.log("Calling page.update with: "+JSON.stringify(s)),(m=this.pages[this.currentPage])==null||m.update(s,i)}static open(s,e){window.setTimeout(()=>{let t="";for(let n in e)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]);location.hash="#"+encodeURIComponent(s)+t},200)}static back(){history.back()}}class c{constructor(){}static APPLY_COUNTED(s,e){return e.replace("{count}",s.toString())}}l(c,"TIME_LOCALE","en"),l(c,"TIME_YESTERDAY","yesterday"),l(c,"TIME_HOURS_AGO","{count} hour(s) ago"),l(c,"TIME_MINUTES_AGO","{count} minute(s) ago"),l(c,"TIME_SECONDS_AGO","{count} second(s) ago"),l(c,"TIME_TODAY_AT","today at"),l(c,"TIME_JUST_NOW","just now"),l(c,"APPNAME","Knowledgebase"),l(c,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),l(c,"LOGIN_SESSION_NAME","Session Name"),l(c,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),l(c,"LOGIN_API_TOKEN_LABEL","API Token"),l(c,"LOGIN_SUBMIT","Add Connection"),l(c,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),l(c,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),l(c,"LOGIN_OFFLINE_MODAL_QUESTION","Cannot connect to server. Do you want to continue in offline mode? Offline mode might show you outdated files and data."),l(c,"LOGIN_OFFLINE_MODAL_CONFIRM","Continue offline"),l(c,"LOGIN_OFFLINE_MODAL_CANCEL","Return to login"),l(c,"SEARCH_FILETREE_IS_NULL","Cannot retrieve list of files. Maybe you have a weak internet connection."),l(c,"SEARCH_PLACEHOLDER","Search (Keyword, Keyword, Keyword)"),l(c,"SEARCH_LAST_MODIFIED","modified"),l(c,"SEARCH_CREATED","created"),l(c,"SEARCH_NUM_RESULTS","files found"),l(c,"SEARCH_OFFLINE","(<span style='color: red'>offline</span>)"),l(c,"SEARCH_MORE_RESULTS","Click here to show more results!"),l(c,"SETTINGS_TITLE","Settings"),l(c,"SETTINGS_GENERAL","General"),l(c,"SETTINGS_CONNECTION","Connection"),l(c,"SETTINGS_SELECT_SERVER","Select server"),l(c,"SETTINGS_DISPLAY","Display"),l(c,"SETTINGS_SHOW_TXT_PREVIEWS","Show previews for text documents"),l(c,"SETTINGS_SHOW_IMG_PREVIEWS","Show previews for images"),l(c,"SETTINGS_SHOW_PDF_PREVIEWS","Show previews for PDFs");class L extends c{}l(L,"TIME_LOCALE","de"),l(L,"APPNAME","Wissensdatenbank");let r=c;function U(){switch(localStorage.language){case"de":r=L;break;case"en":case"us":default:r=c;break}}class _{constructor(s){l(this,"apiEndpoint","");l(this,"sessionToken","");this.session_name=s,this.loadSessionConfig()}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let s=JSON.parse(localStorage.webfs_sessions);if(this.session_name in s){let e=s[this.session_name];this.apiEndpoint=e.apiEndpoint,this.sessionToken=e.sessionToken}}}writeSessionConfig(s,e){this.apiEndpoint=s,this.sessionToken=e;let t={};localStorage.webfs_sessions&&(t=JSON.parse(localStorage.webfs_sessions)),t[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:e},localStorage.webfs_sessions=JSON.stringify(t)}removeSession(){if(localStorage.webfs_sessions){let s=JSON.parse(localStorage.webfs_sessions);s.indexOf(this.session_name)>=0&&s.remove(this.session_name)}}async request(s){s.append("token",this.sessionToken);const e={method:"POST",body:s};try{return await fetch(this.apiEndpoint,e)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let s=new FormData;s.append("cmd","ping"),s.append("uri",".");let e=await this.request(s);return e==null?!1:e.status!=200?(console.error(e.text()),!1):await e.text()=="pong"}async login(s,e){let t=new FormData;t.append("cmd","login"),t.append("uri","."),t.append("token",e);const n={method:"POST",body:t};let i;try{i=await fetch(s,n)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(i.status!=200)return console.error(i.text()),!1;let o=await i.text();return this.writeSessionConfig(s,o),!0}buildFileTree(s){return s}async list(s){let e=new FormData;e.append("cmd","list"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):await t.json()}async walk(s){let e=new FormData;e.append("cmd","walk"),e.append("uri",s);let t=await this.request(e);if(t==null)return null;if(t.status!=200)return console.error(t.text()),null;let n=await t.json();return this.buildFileTree(n)}async md5(s){let e=new FormData;e.append("cmd","md5"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):t.text()}async open(s){let e=new FormData;e.append("cmd","open"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async readTxt(s){let e=new FormData;e.append("cmd","read"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):t.text()}readURL(s,e=!1){let t="";return e&&(t="&subsample=1&width=256&height=256"),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(s)+t}read(s,e="_self"){function t(o,u,m){let p=document.createElement("input");p.type="hidden",p.name=u,p.value=m,o.appendChild(p)}let n=document.getElementsByTagName("body")[0],i=document.createElement("form");i.action=this.apiEndpoint,i.method="post",i.target=e,t(i,"cmd","read"),t(i,"token",this.sessionToken),t(i,"uri",s),n.appendChild(i),i.submit(),n.removeChild(i)}async putTxt(s,e,t){return this.putFile(s,e,t)}async putFile(s,e,t){let n="",i=new FormData;i.append("cmd","write"),i.append("operation","write"),i.append("uri",s),i.append("file",e),i.append("md5",t+","+n);let o=await this.request(i);return o==null?!1:o.status!=200?(console.error(o.text()),!1):(await o.text(),!0)}async mkdir(s){let e=new FormData;e.append("cmd","write"),e.append("operation","mkdir"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async rmdir(s){let e=new FormData;e.append("cmd","write"),e.append("operation","rmdir"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async mv(s,e){let t=new FormData;t.append("cmd","write"),t.append("operation","mv"),t.append("uri",s),t.append("target",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rm(s,e){let t=new FormData;t.append("cmd","write"),t.append("operation","rm"),t.append("uri",s),t.append("md5",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}}l(_,"instance",null);class h{constructor(s,e="",t=""){l(this,"parent",null);l(this,"htmlElement");l(this,"displayStyle","none");this.htmlElement=document.createElement(s),this.htmlElement.innerHTML=e,t!=""&&this.setClass(t)}add(s){this.htmlElement.appendChild(s.htmlElement),s.parent=this}remove(s){this.htmlElement.removeChild(s.htmlElement),s.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(s,e){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(s){this.htmlElement.classList.contains(s)||this.htmlElement.classList.add(s)}unsetClass(s){this.htmlElement.classList.contains(s)||this.htmlElement.classList.remove(s)}}class g extends h{constructor(s,e=""){super("a",s,e),this.htmlElement.onclick=()=>{this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class B extends h{constructor(...s){super("div");for(const e of s)this.add(e)}submit(){let s=new FormData;for(const e in this.htmlElement.children){let t=this.htmlElement.children[e];t instanceof HTMLInputElement&&s.append(t.name,t.value)}this.onSubmit(s)}onSubmit(s){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(s)}}class T extends h{constructor(s,e,t,n=""){super("input"),this.htmlElement.name=s,this.htmlElement.placeholder=e,this.htmlElement.type=t,n!=""&&this.setClass(n),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(s=void 0){return s!==void 0&&(this.htmlElement.value=s),this.htmlElement.value}onChange(s){}onChangeDone(s){}}class C extends h{constructor(s,e=""){super("label",s,e)}}class O extends h{constructor(s,e,t="",n=!1){super("div");let i=new h("input");i.htmlElement.name=s,i.htmlElement.type="checkbox",i.htmlElement.checked=n,t!=""&&this.setClass(t),i.htmlElement.onchange=()=>{this.onChange(i.htmlElement.checked)},this.add(i);let o=new h("label");o.htmlElement.innerHTML=e,this.add(o)}onChange(s){console.log("Checkbox::onChange: Not implemented! Must be implemented by subclass.")}}class W extends g{onClick(){this.parent.submit()}}let Y='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>',J='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>';class M extends h{constructor(e,t){var n;super("div");l(this,"container");this.setClass(e),this.container=new h("div"),this.container.setClass(t),this.container.add(this),(n=document.getElementById("global"))==null||n.appendChild(this.container.htmlElement)}dispose(){var e;(e=document.getElementById("global"))==null||e.removeChild(this.container.htmlElement)}update(){}}class q extends M{constructor(s,e,t,n,i){super(s,e),this.add(new h("p",t));let o=new g(n);o.onClick=()=>{this.dispose(),this.onConfirm()},this.add(o);let u=new g(i);u.onClick=()=>{this.dispose(),this.onCancel()},this.add(u)}onConfirm(){console.log("ConfirmCancelPopup::onConfirm not implemented. Must be implemented by subclass.")}onCancel(){console.log("ConfirmCancelPopup::onCancel not implemented. Must be implemented by subclass.")}}class j extends M{constructor(s,e,t=""){super(s,e);let n=new g(J,t);n.onClick=this.dispose.bind(this),this.add(n)}update(){}}class V extends h{constructor(){super("div");l(this,"connections");this.setClass("loginView"),this.connections=new h("div"),this.add(this.connections);let e=new B(new C(r.LOGIN_SESSION_NAME,"loginLabel"),new T("sessionName","myserver","text","loginInput"),new C(r.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new T("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new C(r.LOGIN_API_TOKEN_LABEL,"loginLabel"),new T("apiToken","a4ef9...","password","loginInput"),new W(r.LOGIN_SUBMIT,"buttonWide"));e.setClass("loginForm"),e.onSubmit=this.onCreateSession.bind(this),this.add(e)}update(e,t){if(this.connections.htmlElement.innerHTML="",localStorage.kb_sessions){let n=JSON.parse(localStorage.kb_sessions);n.length>0&&this.connections.add(new C(r.LOGIN_KNOWN_CONNECTIONS,"loginLabel"));for(const i of n){let o=new g(i,"buttonWide");o.onClick=()=>{P(i)},this.connections.add(o)}if(n.length>0){let i=new h("hr");i.setClass("loginDivider"),this.connections.add(i)}}}async onCreateSession(e){let t=e.get("sessionName"),n=e.get("apiEndpoint"),i=e.get("apiToken");if(t==""||n==""||i==""||t==null||n==null||i==null){alert(r.LOGIN_ERROR_MISSING_INPUTS);return}let o=new _(t);if(await o.login(n,i)){let u=[];localStorage.kb_sessions&&(u=JSON.parse(localStorage.kb_sessions)),u.push(t),localStorage.kb_sessions=JSON.stringify(u),_.instance=o,E.back()}else alert(r.LOGIN_ERROR_LOGIN_FAILED)}}async function P(a,s=!1){console.log("Connecting to: "+a);let e=new _(a);if(await e.ping())_.instance=e,localStorage.kb_last_session=a,s||E.back();else{let t=new q("popupContent","popupContainer",r.LOGIN_OFFLINE_MODAL_QUESTION,r.LOGIN_OFFLINE_MODAL_CONFIRM,r.LOGIN_OFFLINE_MODAL_CANCEL);return new Promise(n=>{t.onConfirm=()=>{_.instance=e,localStorage.kb_last_session=a,s||E.back(),n()},t.onCancel=()=>{n()}})}}async function K(){if(localStorage.kb_sessions){let a=JSON.parse(localStorage.kb_sessions);if(a.length>0){let s=a[0];localStorage.kb_last_session&&(s=localStorage.kb_last_session),await P(s,!0)}}}const z=6,$=6,Q=10,X=12,Z=.001,y=31557600,b=2629800,v=86400,R=3600,D=60;function ee(a,s="long"){let e=new Date;const t=A(e,a),{hours:n,minutes:i,seconds:o}=t;let u=new Date(e.toISOString().substring(0,10)),m=new Date(a.toISOString().substring(0,10));const p=A(u,m),{years:f,months:S,days:d}=p;return f>100?"unknown":f>0||S>$?F(a,{includeYear:!0,length:s}):S>0||d>z?F(a,{includeYear:!1,length:s}):d>1?a.toLocaleDateString(r.TIME_LOCALE,{weekday:s}):d===1?r.TIME_YESTERDAY:n>X?r.TIME_TODAY_AT+" "+a.toLocaleTimeString(r.TIME_LOCALE,{hour:"numeric",minute:"2-digit"}):n>0?r.APPLY_COUNTED(n,r.TIME_HOURS_AGO):i>0?r.APPLY_COUNTED(i,r.TIME_MINUTES_AGO):o>Q?r.APPLY_COUNTED(o,r.TIME_SECONDS_AGO):r.TIME_JUST_NOW}function F(a,{includeYear:s,length:e}){const t=a.toLocaleDateString(r.TIME_LOCALE,{month:e});let i=`${a.getDate().toString()}. ${t}`;return s&&(i+=` ${a.getFullYear()}`),i}function k(a){return Math.floor(a*Z)}function A(a,s){const e={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};let t=k(a.valueOf())-k(s.valueOf());return e.years=Math.floor(t/y),t-=e.years*y,e.months=Math.floor(t/b),t-=e.months*b,e.days=Math.floor(t/v),t-=e.days*v,e.hours=Math.floor(t/R),t-=e.hours*R,e.minutes=Math.floor(t/D),t-=e.minutes*D,e.seconds=t,e}class te extends h{constructor(){super("div");l(this,"searchField");l(this,"results");l(this,"fileTree",null);l(this,"isOffline",!1);this.searchField=new T("search",r.SEARCH_PLACEHOLDER,"search","searchInput"),this.searchField.onChange=t=>{this.updateSearchResults()},this.searchField.onChangeDone=t=>{E.open("search",{q:t})},this.add(this.searchField),this.results=new h("div"),this.results.setClass("searchResults"),this.add(this.results);let e=new g(Y,"settingsOpen");e.onClick=()=>{new ie},this.add(e)}async update(e,t){var n;if(_.instance==null){E.open("login",{});return}if(t)if(this.fileTree=await((n=_.instance)==null?void 0:n.walk(".")),this.fileTree==null){let i=_.instance.getSessionName(),o=localStorage["kb_filetree_cache_"+i];o&&(this.fileTree=JSON.parse(o)),this.isOffline=!0}else{let i=_.instance.getSessionName(),o=JSON.stringify(this.fileTree);localStorage["kb_filetree_cache_"+i]=o,this.isOffline=!1}this.searchField.value(e.q),this.updateSearchResults()}async updateSearchResults(e=50){let t=this.searchField.value();if(this.results.htmlElement.innerHTML="",this.fileTree==null){alert(r.SEARCH_FILETREE_IS_NULL);return}let n=this.flatten(this.fileTree);n=this.sortFilesByLastModified(n),n=this.sortFilesByRelevance(n,t),this.showNumResults(n);let i=n.length;n=n.slice(0,e);for(let o of n)this.results.add(new se(o.filepath,o.modified!=null?ee(o.modified):"",o.isFolder,this.searchField));if(i>e){let o=new h("div");o.htmlElement.innerText=r.SEARCH_MORE_RESULTS,o.setClass("searchMoreResults"),o.htmlElement.onclick=()=>{this.updateSearchResults(e+25)},this.results.add(o)}}showNumResults(e){let t=new h("div"),n="";this.isOffline&&(n=" "+r.SEARCH_OFFLINE),t.htmlElement.innerHTML=e.length+" "+r.SEARCH_NUM_RESULTS+n,t.setClass("searchNumResults"),this.results.add(t)}sortFilesByRelevance(e,t){let n=t.toLowerCase().split(",").map(u=>u.trim()),i=[];for(let u of e){let{filename:m,folder:p}=x(u.filepath);m=m.toLowerCase(),p=p.toLowerCase();var o=0;for(let f of n){if(f==""){o=1;continue}let S=f.startsWith("/"),d=f.substring(1);d==""&&(d="."),!S&&m.includes(f)&&(o+=100,u.isFolder&&(o+=10)),S&&u.isFolder&&m.includes(d)&&u.filepath.toLowerCase()!=d&&(o+=125,m==d&&(o+=25)),S&&p==d&&(o+=100,u.isFolder&&(o+=10))}o>0&&i.push({filepath:u.filepath,modified:u.modified,isFolder:u.isFolder,score:o})}return i.sort((u,m)=>m.score-u.score)}sortFilesByLastModified(e){return e.sort((t,n)=>t.modified==null?1:n.modified==null?-1:n.modified.toISOString().localeCompare(t.modified.toISOString()))}flatten(e,t="",n=[]){for(const i in e){const o=e[i];typeof o!="string"?(n=this.flatten(o,t+i+"/",n),n.push({filepath:t+i,modified:null,isFolder:!0})):n.push({filepath:t+i,modified:new Date(o),isFolder:!1})}return n}}class se extends h{constructor(s,e,t,n){super("div"),this.setClass("searchResult");let{filename:i,folder:o}=x(s),u=i.split(".");t&&u.push("DIR");let m=u[u.length-1].toLowerCase();if(localStorage.kb_allow_img_previews=="true"&&(m=="png"||m=="jpg"||m=="jpeg")||localStorage.kb_allow_pdf_previews=="true"&&m=="pdf"){let d=document.createElement("img");d.classList.add("searchResultPreview"),d.onerror=()=>{let w=document.createElement("div");w.innerHTML="<BR>"+m.toUpperCase(),w.classList.add("searchResultPreview"),this.htmlElement.replaceChild(w,this.htmlElement.childNodes[0])},d.src=_.instance.readURL(s,!0),this.htmlElement.appendChild(d)}else if(localStorage.kb_allow_txt_previews=="true"&&(m=="txt"||m=="md"||m=="py"||m=="csv"||m=="json")){let d=document.createElement("div");d.style.fontSize="1em",d.style.textAlign="left",d.innerHTML="loading...",ne.getTxtPreview(s).then(w=>{let I=w.split(`
`);I=I.map((N,le,re)=>N.startsWith("#")?"<b style='font-size: 1.2em'>"+N+"</b>":N),w=I.join("<BR>"),d.innerHTML=w}),d.classList.add("searchResultPreview"),this.htmlElement.appendChild(d)}else{let d=document.createElement("div");d.innerHTML="<BR>"+m.toUpperCase(),d.classList.add("searchResultPreview"),this.htmlElement.appendChild(d)}let p=document.createElement("div");p.classList.add("searchResultMeta"),this.htmlElement.appendChild(p);let f=document.createElement("div");if(f.innerText=i,f.classList.add("searchResultFilename"),p.appendChild(f),e!=""){let d=document.createElement("div");d.innerText=r.SEARCH_LAST_MODIFIED+": "+e,d.classList.add("searchResultModified"),p.appendChild(d)}let S=document.createElement("div");S.innerText=o,S.classList.add("searchResultFolder"),p.appendChild(S),this.htmlElement.onclick=()=>{t?(n.htmlElement.value="/"+s,n.onChange(n.htmlElement.value),n.onChangeDone(n.htmlElement.value)):E.open("edit",{folder:o,filename:i})}}}function x(a){let s=a.split("/"),e=s.pop(),t=s.join("/");return t==""&&(t="."),{filename:e,folder:t}}class ne{constructor(){}static async getTxtPreview(s){let e=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");if(e[s])return e[s];let t=await _.instance.readTxt(s);if(t!=null){let n=t.split(`
`).slice(0,13);n=n.map((o,u,m)=>o.slice(0,40)),t=n.join(`
`);let i=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");return i[s]=t,localStorage.setItem("kb_preview_cache",JSON.stringify(i)),t}return"error loading preview"}static async getImgPreview(s){return""}}class ie extends j{constructor(){super("settingsOverlayContent","settingsOverlay","settingsExit"),this.add(new h("div",r.SETTINGS_TITLE,"settingsTitle")),this.add(new h("div",r.SETTINGS_GENERAL,"settingsSubtitle")),this.add(new h("div",r.SETTINGS_DISPLAY,"settingsSubtitle"));let s=new O("showTxtPreviews",r.SETTINGS_SHOW_TXT_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_txt_previews=="true");s.onChange=i=>{localStorage.kb_allow_txt_previews=i},this.add(s);let e=new O("showImgPreviews",r.SETTINGS_SHOW_IMG_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_img_previews=="true");e.onChange=i=>{localStorage.kb_allow_img_previews=i},this.add(e);let t=new O("showPDFPreviews",r.SETTINGS_SHOW_PDF_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_pdf_previews=="true");t.onChange=i=>{localStorage.kb_allow_pdf_previews=i},this.add(t),this.add(new h("div",r.SETTINGS_CONNECTION,"settingsSubtitle"));let n=new g(r.SETTINGS_SELECT_SERVER,"buttonWide");n.onClick=()=>{this.dispose(),E.open("login",{})},this.add(n)}update(){}}class oe extends h{constructor(){super("div");l(this,"iframe");this.iframe=document.createElement("iframe"),this.iframe.name="editFrame",this.iframe.classList.add("editFrame"),this.htmlElement.appendChild(this.iframe)}async update(e,t){var n;if(_.instance==null){E.open("login",{});return}(n=_.instance)==null||n.read(e.folder+"/"+e.filename,"editFrame")}hide(){this.iframe.src="about:blank",super.hide()}}async function ae(){U(),document.getElementsByTagName("title")[0].innerHTML=r.APPNAME,await K(),new E("search",{search:new te,login:new V,edit:new oe})}ae();
