var q=Object.defineProperty;var J=(l,s,e)=>s in l?q(l,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[s]=e;var a=(l,s,e)=>(J(l,typeof s!="symbol"?s+"":s,e),e);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class C{constructor(s,e){a(this,"currentPage","");var t;this.defaultPage=s,this.pages=e;for(const n in e)(t=document.getElementById("app"))==null||t.appendChild(e[n].htmlElement),e[n].hide();window.onhashchange=n=>{this.onOpen()},location.hash.slice(1)==""?location.hash="#"+s:this.onOpen()}onOpen(){var o,c,m;let s={},e=this.defaultPage,n=location.hash.slice(1).split("&");n.length>0&&(e=n[0],n=n.splice(1));for(const u of n){let w=u.split("="),S=decodeURIComponent(w[0]),_=decodeURIComponent(w[1]);s[S]=_}let i=this.currentPage!=e;i&&(console.log("Hide page: "+this.currentPage),(o=this.pages[this.currentPage])==null||o.hide(),this.currentPage=e,console.log("Show page: "+e),(c=this.pages[this.currentPage])==null||c.show()),console.log("Calling page.update with: "+JSON.stringify(s)),(m=this.pages[this.currentPage])==null||m.update(s,i)}static open(s,e){window.setTimeout(()=>{let t="";for(let n in e)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(e[n]);location.hash="#"+encodeURIComponent(s)+t},200)}static back(){history.back()}}class d{constructor(){}static APPLY_COUNTED(s,e){return e.replace("{count}",s.toString())}}a(d,"TIME_LOCALE","en"),a(d,"TIME_YESTERDAY","yesterday"),a(d,"TIME_HOURS_AGO","{count} hour(s) ago"),a(d,"TIME_MINUTES_AGO","{count} minute(s) ago"),a(d,"TIME_SECONDS_AGO","{count} second(s) ago"),a(d,"TIME_TODAY_AT","today at"),a(d,"TIME_JUST_NOW","just now"),a(d,"APPNAME","Knowledgebase"),a(d,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),a(d,"LOGIN_SESSION_NAME","Session Name"),a(d,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),a(d,"LOGIN_API_TOKEN_LABEL","API Token"),a(d,"LOGIN_SUBMIT","Add Connection"),a(d,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),a(d,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),a(d,"LOGIN_OFFLINE_MODAL_QUESTION","Cannot connect to server. Do you want to continue in offline mode? Offline mode might show you outdated files and data."),a(d,"LOGIN_OFFLINE_MODAL_CONFIRM","Continue offline"),a(d,"LOGIN_OFFLINE_MODAL_CANCEL","Return to login"),a(d,"SEARCH_FILETREE_IS_NULL","Cannot retrieve list of files. Maybe you have a weak internet connection."),a(d,"SEARCH_PLACEHOLDER","Search (Keyword, Keyword, Keyword)"),a(d,"SEARCH_LAST_MODIFIED","modified"),a(d,"SEARCH_CREATED","created"),a(d,"SEARCH_NUM_RESULTS","files found"),a(d,"SEARCH_OFFLINE","(<span style='color: red'>offline</span>)"),a(d,"SEARCH_MORE_RESULTS","Click here to show more results!"),a(d,"SETTINGS_TITLE","Settings"),a(d,"SETTINGS_GENERAL","General"),a(d,"SETTINGS_CONNECTION","Connection"),a(d,"SETTINGS_SELECT_SERVER","Select server"),a(d,"SETTINGS_DISPLAY","Display"),a(d,"SETTINGS_SHOW_TXT_PREVIEWS","Show previews for text documents"),a(d,"SETTINGS_SHOW_IMG_PREVIEWS","Show previews for images"),a(d,"SETTINGS_SHOW_PDF_PREVIEWS","Show previews for PDFs");class b extends d{}a(b,"TIME_LOCALE","de"),a(b,"APPNAME","Wissensdatenbank");let r=d;function z(){switch(localStorage.language){case"de":r=b;break;case"en":case"us":default:r=d;break}}class f{constructor(s){a(this,"apiEndpoint","");a(this,"sessionToken","");this.session_name=s,this.loadSessionConfig()}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let s=JSON.parse(localStorage.webfs_sessions);if(this.session_name in s){let e=s[this.session_name];this.apiEndpoint=e.apiEndpoint,this.sessionToken=e.sessionToken}}}writeSessionConfig(s,e){this.apiEndpoint=s,this.sessionToken=e;let t={};localStorage.webfs_sessions&&(t=JSON.parse(localStorage.webfs_sessions)),t[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:e},localStorage.webfs_sessions=JSON.stringify(t)}removeSession(){if(localStorage.webfs_sessions){let s=JSON.parse(localStorage.webfs_sessions);s.indexOf(this.session_name)>=0&&s.remove(this.session_name)}}async request(s){s.append("token",this.sessionToken);const e={method:"POST",body:s};try{return await fetch(this.apiEndpoint,e)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let s=new FormData;s.append("cmd","ping"),s.append("uri",".");let e=await this.request(s);return e==null?!1:e.status!=200?(console.error(e.text()),!1):await e.text()=="pong"}async login(s,e){let t=new FormData;t.append("cmd","login"),t.append("uri","."),t.append("token",e);const n={method:"POST",body:t};let i;try{i=await fetch(s,n)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(i.status!=200)return console.error(i.text()),!1;let o=await i.text();return this.writeSessionConfig(s,o),!0}buildFileTree(s){return s}async list(s){let e=new FormData;e.append("cmd","list"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):await t.json()}async walk(s){let e=new FormData;e.append("cmd","walk"),e.append("uri",s);let t=await this.request(e);if(t==null)return null;if(t.status!=200)return console.error(t.text()),null;let n=await t.json();return this.buildFileTree(n)}async md5(s){let e=new FormData;e.append("cmd","md5"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):t.text()}async open(s){let e=new FormData;e.append("cmd","open"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async readTxt(s){let e=new FormData;e.append("cmd","read"),e.append("uri",s);let t=await this.request(e);return t==null?null:t.status!=200?(console.error(t.text()),null):t.text()}readURL(s,e=!1){let t="";return e&&(t="&subsample=1&width=256&height=256"),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(s)+t}read(s,e="_self"){function t(o,c,m){let u=document.createElement("input");u.type="hidden",u.name=c,u.value=m,o.appendChild(u)}let n=document.getElementsByTagName("body")[0],i=document.createElement("form");i.action=this.apiEndpoint,i.method="post",i.target=e,t(i,"cmd","read"),t(i,"token",this.sessionToken),t(i,"uri",s),n.appendChild(i),i.submit(),n.removeChild(i)}async putTxt(s,e,t){return this.putFile(s,e,t)}async putFile(s,e,t){let n="",i=new FormData;i.append("cmd","write"),i.append("operation","write"),i.append("uri",s),i.append("file",e),i.append("md5",t+","+n);let o=await this.request(i);return o==null?!1:o.status!=200?(console.error(o.text()),!1):(await o.text(),!0)}async mkdir(s){let e=new FormData;e.append("cmd","write"),e.append("operation","mkdir"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async rmdir(s){let e=new FormData;e.append("cmd","write"),e.append("operation","rmdir"),e.append("uri",s);let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):(await t.text(),!0)}async mv(s,e){let t=new FormData;t.append("cmd","write"),t.append("operation","mv"),t.append("uri",s),t.append("target",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rm(s,e){let t=new FormData;t.append("cmd","write"),t.append("operation","rm"),t.append("uri",s),t.append("md5",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}}a(f,"instance",null);class h{constructor(s,e="",t=""){a(this,"parent",null);a(this,"htmlElement");a(this,"displayStyle","none");this.htmlElement=document.createElement(s),this.htmlElement.innerHTML=e,t!=""&&this.setClass(t)}add(s){this.htmlElement.appendChild(s.htmlElement),s.parent=this}remove(s){this.htmlElement.removeChild(s.htmlElement),s.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(s,e){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(s){this.htmlElement.classList.contains(s)||this.htmlElement.classList.add(s)}unsetClass(s){this.htmlElement.classList.contains(s)||this.htmlElement.classList.remove(s)}}class g extends h{constructor(s,e=""){super("a",s,e),this.htmlElement.onclick=t=>{t.stopPropagation(),this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class j extends h{constructor(...s){super("div");for(const e of s)this.add(e)}submit(){let s=new FormData;for(const e in this.htmlElement.children){let t=this.htmlElement.children[e];t instanceof HTMLInputElement&&s.append(t.name,t.value)}this.onSubmit(s)}onSubmit(s){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(s)}}class N extends h{constructor(s,e,t,n=""){super("input"),this.htmlElement.name=s,this.htmlElement.placeholder=e,this.htmlElement.type=t,n!=""&&this.setClass(n),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(s=void 0){return s!==void 0&&(this.htmlElement.value=s),this.htmlElement.value}onChange(s){}onChangeDone(s){}}class O extends h{constructor(s,e=""){super("label",s,e)}}class y extends h{constructor(e,t,n="",i=!1){super("div");a(this,"checkbox");this.checkbox=new h("input"),this.checkbox.htmlElement.name=e,this.checkbox.htmlElement.type="checkbox",this.checkbox.htmlElement.checked=i,n!=""&&this.setClass(n),this.checkbox.htmlElement.onchange=()=>{this.onChange(this.checkbox.htmlElement.checked)},this.add(this.checkbox);let o=new h("label");o.htmlElement.innerHTML=t,this.add(o)}onChange(e){console.log("Checkbox::onChange: Not implemented! Must be implemented by subclass.")}value(e=void 0){return e!==void 0&&(this.checkbox.htmlElement.checked=e),this.checkbox.htmlElement.checked}}class K extends g{onClick(){this.parent.submit()}}let $='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>',Q='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>';class U extends h{constructor(e,t){var n;super("div");a(this,"container");this.setClass(e),this.container=new h("div"),this.container.setClass(t),this.container.add(this),(n=document.getElementById("global"))==null||n.appendChild(this.container.htmlElement)}dispose(){var e;(e=document.getElementById("global"))==null||e.removeChild(this.container.htmlElement)}update(){}}class X extends U{constructor(s,e,t,n,i){super(s,e),this.add(new h("p",t));let o=new g(n);o.onClick=()=>{this.dispose(),this.onConfirm()},this.add(o);let c=new g(i);c.onClick=()=>{this.dispose(),this.onCancel()},this.add(c)}onConfirm(){console.log("ConfirmCancelPopup::onConfirm not implemented. Must be implemented by subclass.")}onCancel(){console.log("ConfirmCancelPopup::onCancel not implemented. Must be implemented by subclass.")}}class Z extends U{constructor(s,e,t=""){super(s,e);let n=new g(Q,t);n.onClick=this.dispose.bind(this),this.add(n)}update(){}}class ee extends h{constructor(){super("div");a(this,"connections");this.setClass("loginView"),this.connections=new h("div"),this.add(this.connections);let e=new j(new O(r.LOGIN_SESSION_NAME,"loginLabel"),new N("sessionName","myserver","text","loginInput"),new O(r.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new N("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new O(r.LOGIN_API_TOKEN_LABEL,"loginLabel"),new N("apiToken","a4ef9...","password","loginInput"),new K(r.LOGIN_SUBMIT,"buttonWide"));e.setClass("loginForm"),e.onSubmit=this.onCreateSession.bind(this),this.add(e)}update(e,t){if(this.connections.htmlElement.innerHTML="",localStorage.kb_sessions){let n=JSON.parse(localStorage.kb_sessions);n.length>0&&this.connections.add(new O(r.LOGIN_KNOWN_CONNECTIONS,"loginLabel"));for(const i of n){let o=new g(i,"buttonWide");o.onClick=()=>{V(i)},this.connections.add(o)}if(n.length>0){let i=new h("hr");i.setClass("loginDivider"),this.connections.add(i)}}}async onCreateSession(e){let t=e.get("sessionName"),n=e.get("apiEndpoint"),i=e.get("apiToken");if(t==""||n==""||i==""||t==null||n==null||i==null){alert(r.LOGIN_ERROR_MISSING_INPUTS);return}let o=new f(t);if(await o.login(n,i)){let c=[];localStorage.kb_sessions&&(c=JSON.parse(localStorage.kb_sessions)),c.push(t),localStorage.kb_sessions=JSON.stringify(c),f.instance=o,C.back()}else alert(r.LOGIN_ERROR_LOGIN_FAILED)}}async function V(l,s=!1){console.log("Connecting to: "+l);let e=new f(l);if(await e.ping())f.instance=e,localStorage.kb_last_session=l,s||C.back();else{let t=new X("popupContent","popupContainer",r.LOGIN_OFFLINE_MODAL_QUESTION,r.LOGIN_OFFLINE_MODAL_CONFIRM,r.LOGIN_OFFLINE_MODAL_CANCEL);return new Promise(n=>{t.onConfirm=()=>{f.instance=e,localStorage.kb_last_session=l,s||C.back(),n()},t.onCancel=()=>{n()}})}}async function te(){if(localStorage.kb_sessions){let l=JSON.parse(localStorage.kb_sessions);if(l.length>0){let s=l[0];localStorage.kb_last_session&&(s=localStorage.kb_last_session),await V(s,!0)}}}const se=6,ne=6,ie=10,oe=12,ae=.001,D=31557600,x=2629800,M=86400,A=3600,P=60;function le(l,s="long"){let e=new Date;const t=B(e,l),{hours:n,minutes:i,seconds:o}=t;let c=new Date(e.toISOString().substring(0,10)),m=new Date(l.toISOString().substring(0,10));const u=B(c,m),{years:w,months:S,days:_}=u;return w>100?"unknown":w>0||S>ne?H(l,{includeYear:!0,length:s}):S>0||_>se?H(l,{includeYear:!1,length:s}):_>1?l.toLocaleDateString(r.TIME_LOCALE,{weekday:s}):_===1?r.TIME_YESTERDAY:n>oe?r.TIME_TODAY_AT+" "+l.toLocaleTimeString(r.TIME_LOCALE,{hour:"numeric",minute:"2-digit"}):n>0?r.APPLY_COUNTED(n,r.TIME_HOURS_AGO):i>0?r.APPLY_COUNTED(i,r.TIME_MINUTES_AGO):o>ie?r.APPLY_COUNTED(o,r.TIME_SECONDS_AGO):r.TIME_JUST_NOW}function H(l,{includeYear:s,length:e}){const t=l.toLocaleDateString(r.TIME_LOCALE,{month:e});let i=`${l.getDate().toString()}. ${t}`;return s&&(i+=` ${l.getFullYear()}`),i}function G(l){return Math.floor(l*ae)}function B(l,s){const e={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};let t=G(l.valueOf())-G(s.valueOf());return e.years=Math.floor(t/D),t-=e.years*D,e.months=Math.floor(t/x),t-=e.months*x,e.days=Math.floor(t/M),t-=e.days*M,e.hours=Math.floor(t/A),t-=e.hours*A,e.minutes=Math.floor(t/P),t-=e.minutes*P,e.seconds=t,e}let re='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M575.8 255.5c0 18-15 32.1-32 32.1h-32l.7 160.2c0 2.7-.2 5.4-.5 8.1V472c0 22.1-17.9 40-40 40H456c-1.1 0-2.2 0-3.3-.1c-1.4 .1-2.8 .1-4.2 .1H416 392c-22.1 0-40-17.9-40-40V448 384c0-17.7-14.3-32-32-32H256c-17.7 0-32 14.3-32 32v64 24c0 22.1-17.9 40-40 40H160 128.1c-1.5 0-3-.1-4.5-.2c-1.2 .1-2.4 .2-3.6 .2H104c-22.1 0-40-17.9-40-40V360c0-.9 0-1.9 .1-2.8V287.6H32c-18 0-32-14-32-32.1c0-9 3-17 10-24L266.4 8c7-7 15-8 22-8s15 2 21 7L564.8 231.5c8 7 12 15 11 24z"/></svg>',W='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>',F='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.6 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/></svg>',Y='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 32C64 14.3 49.7 0 32 0S0 14.3 0 32V64 368 480c0 17.7 14.3 32 32 32s32-14.3 32-32V352l64.3-16.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L64 48V32z"/></svg>',R='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M48 24C48 10.7 37.3 0 24 0S0 10.7 0 24V64 350.5 400v88c0 13.3 10.7 24 24 24s24-10.7 24-24V388l80.3-20.1c41.1-10.3 84.6-5.5 122.5 13.4c44.2 22.1 95.5 24.8 141.7 7.4l34.7-13c12.5-4.7 20.8-16.6 20.8-30V66.1c0-23-24.2-38-44.8-27.7l-9.6 4.8c-46.3 23.2-100.8 23.2-147.1 0c-35.1-17.6-75.4-22-113.5-12.5L48 52V24zm0 77.5l96.6-24.2c27-6.7 55.5-3.6 80.4 8.8c54.9 27.4 118.7 29.7 175 6.8V334.7l-24.4 9.1c-33.7 12.6-71.2 10.7-103.4-5.4c-48.2-24.1-103.3-30.1-155.6-17.1L48 338.5v-237z"/></svg>',ce='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 480H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H288c-10.1 0-19.6-4.7-25.6-12.8L243.2 57.6C231.1 41.5 212.1 32 192 32H64C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64z"/></svg>';class de extends h{constructor(){super("div");a(this,"searchField");a(this,"results");a(this,"fileTree",null);a(this,"isOffline",!1);a(this,"favouritesOnly",!1);a(this,"todoOnly",!1);this.searchField=new N("search",r.SEARCH_PLACEHOLDER,"search","searchInput"),this.searchField.onChange=m=>{this.updateSearchResults()},this.searchField.onChangeDone=m=>{C.open("search",{q:m})},this.add(this.searchField),this.results=new h("div"),this.results.setClass("searchResults"),this.add(this.results);let e=new h("div","","searchBottomNavbar"),t=new g(re,"searchBottomNavbarIcon");t.onClick=()=>{this.searchField.htmlElement.value="",this.searchField.onChangeDone("")},e.add(t);let n=new g(ce,"searchBottomNavbarIcon");n.onClick=()=>{this.searchField.htmlElement.value="/",this.searchField.onChangeDone("/")},e.add(n);let i=new g(F,"searchBottomNavbarIcon");i.onClick=()=>{this.favouritesOnly=!this.favouritesOnly,this.favouritesOnly?i.htmlElement.innerHTML=W:i.htmlElement.innerHTML=F,this.updateSearchResults()},e.add(i);let o=new g(R,"searchBottomNavbarIcon");o.onClick=()=>{this.todoOnly=!this.todoOnly,this.todoOnly?o.htmlElement.innerHTML=Y:o.htmlElement.innerHTML=R,this.updateSearchResults()},e.add(o),this.add(e);let c=new g($,"settingsOpen");c.onClick=()=>{new ue},this.add(c)}async update(e,t){var n;if(f.instance==null){C.open("login",{});return}if(t)if(this.fileTree=await((n=f.instance)==null?void 0:n.walk(".")),this.fileTree==null){let i=f.instance.getSessionName(),o=localStorage["kb_filetree_cache_"+i];o&&(this.fileTree=JSON.parse(o)),this.isOffline=!0}else{let i=f.instance.getSessionName(),o=JSON.stringify(this.fileTree);localStorage["kb_filetree_cache_"+i]=o,this.isOffline=!1}this.searchField.value(e.q),this.updateSearchResults()}async updateSearchResults(e=50){let t=this.searchField.value();if(this.results.htmlElement.innerHTML="",this.fileTree==null){alert(r.SEARCH_FILETREE_IS_NULL);return}let n=this.flatten(this.fileTree);n=this.sortFilesByLastModified(n),n=this.sortFilesByRelevance(n,t),n=n.filter(o=>{let c=k(o.filepath).filename;return!(this.favouritesOnly&&!c.includes(".fav")||this.todoOnly&&!c.includes(".todo"))}),this.showNumResults(n);let i=n.length;n=n.slice(0,e);for(let o of n)this.results.add(new he(o.filepath,o.modified!=null?le(o.modified):"",o.isFolder,this.searchField,()=>{this.update({q:this.searchField.value()},!0)}));if(i>e){let o=new h("div");o.htmlElement.innerText=r.SEARCH_MORE_RESULTS,o.setClass("searchMoreResults"),o.htmlElement.onclick=()=>{this.updateSearchResults(e+25)},this.results.add(o)}}showNumResults(e){let t=new h("div"),n="";this.isOffline&&(n=" "+r.SEARCH_OFFLINE),t.htmlElement.innerHTML=e.length+" "+r.SEARCH_NUM_RESULTS+n,t.setClass("searchNumResults"),this.results.add(t)}sortFilesByRelevance(e,t){let n=t.toLowerCase().split(",").map(c=>c.trim()),i=[];for(let c of e){let{filename:m,folder:u}=k(c.filepath);m=m.toLowerCase(),u=u.toLowerCase();var o=0;for(let w of n){if(w==""){o+=1;continue}let S=w.startsWith("/"),_=w.substring(1);_==""&&(_="."),!S&&m.includes(w)&&(o+=100,c.isFolder&&(o+=10)),S&&c.isFolder&&m.includes(_)&&c.filepath.toLowerCase()!=_&&(o+=125,m==_&&(o+=25)),S&&u==_&&(o+=100,c.isFolder&&(o+=10))}o>0&&(m.includes(".fav")&&(o+=3),m.includes(".todo")&&(o+=4),i.push({filepath:c.filepath,modified:c.modified,isFolder:c.isFolder,score:o}))}return i.sort((c,m)=>m.score-c.score)}sortFilesByLastModified(e){return e.sort((t,n)=>t.modified==null?1:n.modified==null?-1:n.modified.toISOString().localeCompare(t.modified.toISOString()))}flatten(e,t="",n=[]){for(const i in e){const o=e[i];typeof o!="string"?(n=this.flatten(o,t+i+"/",n),n.push({filepath:t+i,modified:null,isFolder:!0})):n.push({filepath:t+i,modified:new Date(o),isFolder:!1})}return n}}class he extends h{constructor(s,e,t,n,i){super("div"),this.setClass("searchResult");let{filename:o,folder:c}=k(s),m=o.split(".");t&&m.push("DIR");let u=m[m.length-1].toLowerCase();if(localStorage.kb_allow_img_previews=="true"&&(u=="png"||u=="jpg"||u=="jpeg")||localStorage.kb_allow_pdf_previews=="true"&&u=="pdf"){let p=document.createElement("img");p.classList.add("searchResultPreview"),p.onerror=()=>{let E=document.createElement("div");E.innerHTML="<BR>"+u.toUpperCase(),E.classList.add("searchResultPreview"),this.htmlElement.replaceChild(E,this.htmlElement.childNodes[0])},p.src=f.instance.readURL(s,!0),this.htmlElement.appendChild(p)}else if(localStorage.kb_allow_txt_previews=="true"&&(u=="txt"||u=="md"||u=="py"||u=="csv"||u=="json")){let p=document.createElement("div");p.style.fontSize="1em",p.style.textAlign="left",p.innerHTML="loading...",me.getTxtPreview(s).then(E=>{let v=E.split(`
`);v=v.map((I,T,L)=>I.startsWith("#")?"<b style='font-size: 1.2em'>"+I+"</b>":I),E=v.join("<BR>"),p.innerHTML=E}),p.classList.add("searchResultPreview"),this.htmlElement.appendChild(p)}else{let p=document.createElement("div");p.innerHTML="<BR>"+u.toUpperCase(),p.classList.add("searchResultPreview"),this.htmlElement.appendChild(p)}let w=document.createElement("div");w.classList.add("searchResultMeta"),this.htmlElement.appendChild(w);let S=document.createElement("div");if(S.innerText=o.replace(".todo","").replace(".fav",""),S.classList.add("searchResultFilename"),w.appendChild(S),e!=""){let p=document.createElement("div");p.innerText=r.SEARCH_LAST_MODIFIED+": "+e,p.classList.add("searchResultModified"),w.appendChild(p)}let _=document.createElement("div");if(_.innerText=c,_.classList.add("searchResultFolder"),w.appendChild(_),this.htmlElement.onclick=()=>{t?(n.htmlElement.value="/"+s,n.onChange(n.htmlElement.value),n.onChangeDone(n.htmlElement.value)):C.open("edit",{folder:c,filename:o})},!t){let p=new h("div","","searchResultFlagButtonContainer"),E=o.includes(".fav"),v=new g(E?W:F,"searchResultFlagButton");E&&v.setClass("searchResultFlagButtonActive"),v.onClick=async()=>{if(f.instance!=null){if(E)await f.instance.mv(s,s.replace(".fav",""));else{let L=s.split(".");L.splice(L.length-1,0,"fav"),await f.instance.mv(s,L.join("."))}i()}},p.add(v);let I=o.includes(".todo"),T=new g(I?Y:R,"searchResultFlagButton");I&&T.setClass("searchResultFlagButtonActive"),T.onClick=async()=>{if(f.instance!=null){if(I)await f.instance.mv(s,s.replace(".todo",""));else{let L=s.split(".");L.splice(L.length-1,0,"todo"),await f.instance.mv(s,L.join("."))}i()}},p.add(T),this.add(p)}}}function k(l){let s=l.split("/"),e=s.pop(),t=s.join("/");return t==""&&(t="."),{filename:e,folder:t}}class me{constructor(){}static async getTxtPreview(s){let e=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");if(e[s])return e[s];let t=await f.instance.readTxt(s);if(t!=null){let n=t.split(`
`).slice(0,13);n=n.map((o,c,m)=>o.slice(0,40)),t=n.join(`
`);let i=JSON.parse(localStorage.getItem("kb_preview_cache")||"{}");return i[s]=t,localStorage.setItem("kb_preview_cache",JSON.stringify(i)),t}return"error loading preview"}static async getImgPreview(s){return""}}class ue extends Z{constructor(){super("settingsOverlayContent","settingsOverlay","settingsExit"),this.add(new h("div",r.SETTINGS_TITLE,"settingsTitle")),this.add(new h("div",r.SETTINGS_GENERAL,"settingsSubtitle")),this.add(new h("div",r.SETTINGS_DISPLAY,"settingsSubtitle"));let s=new y("showTxtPreviews",r.SETTINGS_SHOW_TXT_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_txt_previews=="true");s.onChange=i=>{localStorage.kb_allow_txt_previews=i},this.add(s);let e=new y("showImgPreviews",r.SETTINGS_SHOW_IMG_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_img_previews=="true");e.onChange=i=>{localStorage.kb_allow_img_previews=i},this.add(e);let t=new y("showPDFPreviews",r.SETTINGS_SHOW_PDF_PREVIEWS,"settingsCheckbox",localStorage.kb_allow_pdf_previews=="true");t.onChange=i=>{localStorage.kb_allow_pdf_previews=i},this.add(t),this.add(new h("div",r.SETTINGS_CONNECTION,"settingsSubtitle"));let n=new g(r.SETTINGS_SELECT_SERVER,"buttonWide");n.onClick=()=>{this.dispose(),C.open("login",{})},this.add(n)}update(){}}class pe extends h{constructor(){super("div");a(this,"iframe");this.iframe=document.createElement("iframe"),this.iframe.name="editFrame",this.iframe.classList.add("editFrame"),this.htmlElement.appendChild(this.iframe)}async update(e,t){var n;if(f.instance==null){C.open("login",{});return}(n=f.instance)==null||n.read(e.folder+"/"+e.filename,"editFrame")}hide(){this.iframe.src="about:blank",super.hide()}}async function fe(){z(),document.getElementsByTagName("title")[0].innerHTML=r.APPNAME,await te(),new C("search",{search:new de,login:new ee,edit:new pe})}fe();
